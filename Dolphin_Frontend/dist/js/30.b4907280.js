"use strict";(self["webpackChunkdolphin"]=self["webpackChunkdolphin"]||[]).push([[30],{733:(t,e,a)=>{a.d(e,{A:()=>P});var i=a(641),o=a(33),n=a(8634);const s=a.p+"img/VectorLeft.078c6ba0.svg",r=a.p+"img/VectorRight.c1a1a195.svg",c={class:"footer-box"},d={class:"footer-controls split-footer-controls"},l={class:"notifications-page-size-dropdown"},g={key:0,class:"notifications-page-size-menu",ref:"pageSizeMenu"},p=["onClick"],f={class:"notifications-pagination"},u=["disabled"],h=["onClick"],k=["disabled"];function m(t,e,a,m,b,y){return(0,i.uX)(),(0,i.CE)("footer",c,[(0,i.Lk)("div",d,[(0,i.Lk)("div",l,[(0,i.Lk)("button",{class:"notifications-page-size-btn",onClick:e[0]||(e[0]=e=>t.$emit("togglePageDropdown")),ref:"pageSizeBtn"},[(0,i.eW)((0,o.v_)(a.pageSize)+"/page ",1),e[3]||(e[3]=(0,i.Lk)("img",{src:n,class:"notifications-page-size-arrow",alt:"Dropdown"},null,-1))],512),a.showPageDropdown?((0,i.uX)(),(0,i.CE)("div",g,[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(a.pageSizes,e=>((0,i.uX)(),(0,i.CE)("div",{key:e,class:(0,o.C4)(["notifications-page-size-option",{selected:a.pageSize===e}]),onClick:a=>t.$emit("selectPageSize",e)},(0,o.v_)(e)+"/page ",11,p))),128))],512)):(0,i.Q3)("",!0)]),(0,i.Lk)("div",f,[(0,i.Lk)("button",{class:"notifications-pagination-btn prev",disabled:1===a.currentPage,onClick:e[1]||(e[1]=e=>t.$emit("goToPage",a.currentPage-1))},[...e[4]||(e[4]=[(0,i.Lk)("img",{src:s,alt:"Previous",class:"pagination-btn-icon"},null,-1),(0,i.Lk)("span",{class:"pagination-btn-text prev-text"},"Previous",-1)])],8,u),((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(y.computedPaginationPages,e=>((0,i.uX)(),(0,i.CE)(i.FK,null,["..."!==e?((0,i.uX)(),(0,i.CE)("button",{key:e+"-page",class:(0,o.C4)(["notifications-pagination-page",{selected:e===a.currentPage}]),onClick:a=>t.$emit("goToPage",e)},(0,o.v_)(e),11,h)):((0,i.uX)(),(0,i.CE)("span",{key:"ellipsis-"+Math.random(),class:"notifications-pagination-page"},"..."))],64))),256)),(0,i.Lk)("button",{class:"notifications-pagination-btn next",disabled:a.currentPage===a.totalPages,onClick:e[2]||(e[2]=e=>t.$emit("goToPage",a.currentPage+1))},[...e[5]||(e[5]=[(0,i.Lk)("span",{class:"pagination-btn-text next-text"},"Next",-1),(0,i.Lk)("img",{src:r,alt:"Next",class:"pagination-btn-icon"},null,-1)])],8,k)])])])}const b={name:"Pagination",props:{withPagination:{type:Boolean,default:!1},pageSize:Number,pageSizes:Array,showPageDropdown:Boolean,currentPage:Number,totalPages:{type:Number,default:10},paginationPages:Array},computed:{computedPaginationPages(){const t=this.totalPages||10,e=this.currentPage||1;return t<=7?Array.from({length:t},(t,e)=>e+1):e<=3?[1,2,3,4,"...",t-1,t]:4===e?[1,3,4,5,"...",t-1,t]:5===e?[1,4,5,6,"...",t-1,t]:6===e?[1,5,6,7,"...",t-1,t]:7===e?[1,2,"...",6,7,8,t,t-1].filter((t,e,a)=>a.indexOf(t)===e):e===t-2?[1,2,"...",t-3,t-2,t-1,t]:e===t-1||e===t?[1,2,"...",t-2,t-1,t]:[1,2,"...",e-1,e,e+1,"...",t-1,t].filter((t,e,a)=>a.indexOf(t)===e)}},mounted(){document.addEventListener("mousedown",this.handleClickOutside)},beforeUnmount(){document.removeEventListener("mousedown",this.handleClickOutside)},methods:{handleClickOutside(t){if(!this.showPageDropdown)return;const e=this.$refs.pageSizeMenu,a=this.$refs.pageSizeBtn;e&&!e.contains(t.target)&&a&&!a.contains(t.target)&&this.$emit("togglePageDropdown")}}};var y=a(6262);const w=(0,y.A)(b,[["render",m],["__scopeId","data-v-63376d46"]]),P=w},8507:(t,e,a)=>{a.r(e),a.d(e,{default:()=>F});var i=a(641),o=a(3751),n=a(33),s=a(3130);const r={class:"page"},c={class:"notifications-table-outer"},d={class:"notifications-table-card"},l={class:"notifications-controls"},g={class:"notifications-date-wrapper"},p={class:"notifications-tabs"},f=["disabled"],u={key:0},h={key:1},k={class:"notifications-list"},m={class:"notification-body"},b={class:"notification-date"},y={class:"notification-text"},w={class:"notification-meta",style:{display:"flex","flex-direction":"column","align-items":"center"}},P=["onClick"],v={key:0,class:"no-data"},C={key:0},_={key:1};function N(t,e,a,N,D,A){const E=(0,i.g2)("Pagination"),S=(0,i.g2)("MainLayout");return(0,i.uX)(),(0,i.Wv)(S,null,{default:(0,i.k6)(()=>[(0,i.Lk)("div",r,[(0,i.Lk)("div",c,[(0,i.Lk)("div",d,[(0,i.Lk)("div",l,[(0,i.Lk)("div",g,[(0,i.bo)((0,i.Lk)("input",{type:"date",placeholder:"Select Date",class:"notifications-date","onUpdate:modelValue":e[0]||(e[0]=t=>D.selectedDate=t),onChange:e[1]||(e[1]=(...t)=>A.onDateChange&&A.onDateChange(...t))},null,544),[[o.Jo,D.selectedDate]]),D.selectedDate?((0,i.uX)(),(0,i.CE)("button",{key:0,class:"mark-all",style:{"margin-left":"8px",height:"36px"},onClick:e[2]||(e[2]=(...t)=>A.clearDate&&A.clearDate(...t))}," Clear ")):(0,i.Q3)("",!0)]),(0,i.Lk)("div",p,[(0,i.Lk)("button",{class:(0,n.C4)(["notifications-tab-btn-left",{active:"unread"===D.tab}]),onClick:e[3]||(e[3]=t=>A.switchTab("unread"))}," Unread ",2),(0,i.Lk)("button",{class:(0,n.C4)(["notifications-tab-btn-right",{active:"all"===D.tab}]),onClick:e[4]||(e[4]=t=>A.switchTab("all"))}," All ",2)]),"unread"===D.tab&&D.notifications.length>0?((0,i.uX)(),(0,i.CE)("button",{key:0,class:"mark-all",disabled:D.markAllLoading,onClick:e[5]||(e[5]=(...t)=>A.markAllAsRead&&A.markAllAsRead(...t)),style:{"margin-top":"10px",background:"#fff",color:"#0164a5",border:"none","border-radius":"6px",padding:"4px 10px","font-size":"0.95rem",cursor:"pointer"}},[e[6]||(e[6]=(0,i.Lk)("i",{class:"fas fa-check",style:{"margin-right":"6px"}},null,-1)),D.markAllLoading?((0,i.uX)(),(0,i.CE)("span",h,"Marking...")):((0,i.uX)(),(0,i.CE)("span",u,"Mark All As Read"))],8,f)):(0,i.Q3)("",!0)]),(0,i.Lk)("div",k,[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(A.paginatedNotifications,(t,a)=>((0,i.uX)(),(0,i.CE)("div",{key:a,class:"notification-item"},[e[9]||(e[9]=(0,i.Lk)("div",{class:"notification-meta",style:{display:"flex","flex-direction":"column","align-items":"center"}},[(0,i.Lk)("img",{src:s,class:"notification-icon",alt:"Company logo"})],-1)),(0,i.Lk)("div",m,[(0,i.Lk)("span",b,(0,n.v_)(t.date),1),(0,i.Lk)("span",y,[e[7]||(e[7]=(0,i.Lk)("span",{class:"notification-title"},"Dolphin.",-1)),(0,i.eW)(" "+(0,n.v_)(t.body),1)])]),(0,i.Lk)("div",w,["unread"!==D.tab||t.read_at?(0,i.Q3)("",!0):((0,i.uX)(),(0,i.CE)("button",{key:0,class:"mark-all",onClick:e=>A.markAsRead(t.id),style:{"margin-top":"10px",background:"#fff",color:"#0164a5",border:"none","border-radius":"6px",padding:"4px 10px","font-size":"0.95rem",cursor:"pointer"}},[...e[8]||(e[8]=[(0,i.Lk)("i",{class:"fas fa-check"},null,-1)])],8,P))])]))),128)),0===A.paginatedNotifications.length?((0,i.uX)(),(0,i.CE)("div",v,["unread"===D.tab?((0,i.uX)(),(0,i.CE)("span",C,"No unread notifications found.")):((0,i.uX)(),(0,i.CE)("span",_,"No notification found."))])):(0,i.Q3)("",!0)])]),(0,i.bF)(E,{pageSize:D.pageSize,pageSizes:[5,10,20],currentPage:D.page,totalPages:A.totalPages,isNotifications:!0,showPageDropdown:D.showPageDropdown,onGoToPage:A.goToPage,onSelectPageSize:A.selectPageSize,onTogglePageDropdown:A.togglePageDropdown},null,8,["pageSize","currentPage","totalPages","showPageDropdown","onGoToPage","onSelectPageSize","onTogglePageDropdown"])])])]),_:1})}var D=a(4631),A=a(733),E=a(3193),S=a(4220),L=a(4335),z=a(953);(0,z.KR)();const x={name:"GetNotification",components:{Pagination:A.A,MainLayout:D.A},data(){return{tab:"unread",page:1,pageSize:10,showPageDropdown:!1,notifications:[],readNotifications:[],selectedDate:"",markAllLoading:!1}},computed:{totalPages(){return Math.ceil(this.filteredNotifications.length/this.pageSize)||1},paginatedNotifications(){const t=(this.page-1)*this.pageSize;return this.filteredNotifications.slice(t,t+this.pageSize)},filteredNotifications(){let t=[];if(t="unread"===this.tab?this.notifications.slice():"all"===this.tab?[...this.notifications,...this.readNotifications]:this.notifications.slice(),this.selectedDate){const e=this.selectedDate;t=t.filter(t=>{const a=t.created_at||t._rawData&&(t._rawData.created_at||t._rawData.createdAt)||"";if(!a)return!1;const i=new Date(a);if(isNaN(i))return!1;const o=i.getFullYear(),n=String(i.getMonth()+1).padStart(2,"0"),s=String(i.getDate()).padStart(2,"0");return`${o}-${n}-${s}`===e})}return t}},methods:{async switchTab(t){this.tab!==t&&(this.tab=t,this.page=1,await this.fetchNotifications())},async fetchNotifications(){try{const t=this._getAuthHeaders(),e=this._getNotificationEndpoint(),a=await this._fetchDataWithFallback(e,t),i=this._extractNotifications(a),o=E["default"].get("userId")||E["default"].get("user_id"),n=o?parseInt(o,10):0,s=i.filter(t=>this._isNotificationForUser(t,n)).map(t=>this._normalizeNotification(t));this.notifications=s.filter(t=>!t.read_at),this.readNotifications=s.filter(t=>!!t.read_at)}catch(t){this._handleFetchError(t)}},_getAuthHeaders(){let t=E["default"].get("authToken");return t&&"object"===typeof t&&t.token&&(t=t.token),"string"!==typeof t?{}:t?{headers:{Authorization:`Bearer ${t}`}}:{}},_getNotificationEndpoint(){if("unread"===this.tab)return"/api/notifications/unread";const t=S.A.getRole();if("superadmin"===t){const t=E["default"].get("userId")||E["default"].get("user_id"),e=t?parseInt(t,10):0;return e?`/api/notifications?notifiable_type=${encodeURIComponent("App\\Models\\User")}&notifiable_id=${e}`:"/api/notifications"}return"/api/notifications/user"},async _fetchDataWithFallback(t,e){try{return await L.A.get(t,e)}catch(a){if(a.response&&403===a.response.status&&"all"===this.tab)return L.A.get("/api/notifications/user",e);throw a}},_extractNotifications(t){return t&&t.data?Array.isArray(t.data)?t.data:Array.isArray(t.data.notifications)?t.data.notifications:Array.isArray(t.data.unread)?t.data.unread:(console.warn("Unexpected notifications response format:",t.data),[]):[]},_isNotificationForUser(t,e){if(!e)return!0;if(parseInt(t.notifiable_id,10)===e)return!0;if(!t.data)return!1;try{const a="string"===typeof t.data?JSON.parse(t.data):t.data;return a.user_id&&parseInt(a.user_id,10)===e||a.userId&&parseInt(a.userId,10)===e||a.recipient_id&&parseInt(a.recipient_id,10)===e}catch(a){return console.error("Error parsing notification data:",a),!1}},_normalizeNotification(t){let e=t.data;if("string"===typeof e)try{e=JSON.parse(e)}catch(o){console.error("Error parsing notification data:",o)}const a=["body","message","text","details","description","content","msg"];let i=this._pickString(e,a)||t.body||"";return!i&&e&&"object"===typeof e&&(i=this._pickString(e,["user_message","notification","payload"])||(Object.keys(e).length?JSON.stringify(e):"")),{id:t.id,created_at:t.created_at,date:t.created_at?this.formatDate(t.created_at):"",body:i,read_at:t.read_at,_rawData:e}},_pickString(t,e){if(!t)return"";for(const a of e)if(Object.hasOwn(t,a)){const e=t[a];if("string"===typeof e&&e.trim())return e.trim();if("number"===typeof e)return String(e);if(e&&"object"===typeof e&&e.message)return String(e.message)}return""},_handleFetchError(t){this.notifications=[],this.readNotifications=[],console.error("Failed to fetch notifications:",t,t?.response?.data);const e=t?.response?.data?.message||t?.response?.data?.error||null;this.$nextTick(()=>{this.$notify?.({type:"error",message:e||"Failed to fetch notifications."})})},onDateChange(){this.page=1},clearDate(){this.selectedDate="",this.page=1},formatDate(t){const e=new Date(t);if(isNaN(e))return t;const a={month:"short",day:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit",hour12:!0};return e.toLocaleString("en-US",a).replace(",","").replace(/(\d{2}:\d{2}) (AM|PM)/,"at $1 $2")},async markAllAsRead(){try{let e=E["default"].get("authToken");e&&"object"===typeof e&&e.token&&(e=e.token),"string"!==typeof e&&(e="");const a=e?{headers:{Authorization:`Bearer ${e}`}}:{};await L.A.post("/api/notifications/mark-all-read",{},a),await this.fetchNotifications();try{this.updateNotificationCount()}catch(t){console.error("Error updating notification count:",t)}window.dispatchEvent(new Event("notification-updated")),window.dispatchEvent(new Event("storage"))}catch(e){console.error("Error marking all as read:",e),this.$notify&&this.$notify({type:"error",message:"Failed to mark all notifications as read."})}},async markAsRead(t){const e=this.paginatedNotifications.find(e=>e.id===t);let a=E["default"].get("authToken");a&&"object"===typeof a&&a.token&&(a=a.token),"string"!==typeof a&&(a="");const i=a?{headers:{Authorization:`Bearer ${a}`}}:{};if(e&&e.id)try{await L.A.post(`/api/announcements/${e.id}/read`,{},i),await this.fetchNotifications();try{this.updateNotificationCount()}catch(o){console.error("Error updating notification count:",o)}window.dispatchEvent(new Event("notification-updated")),window.dispatchEvent(new Event("storage"))}catch(n){console.error("Failed to mark notification as read:",n),this.$notify&&this.$notify({type:"error",message:"Failed to mark notification as read."})}},prevPage(){this.page>1&&this.page--},nextPage(){this.page<this.totalPages&&this.page++},goToPage(t){t>=1&&t<=this.totalPages&&(this.page=t)},selectPageSize(t){this.pageSize=t,this.page=1,this.showPageDropdown=!1},togglePageDropdown(){this.showPageDropdown=!this.showPageDropdown},updateNotificationCount(){E["default"].set("notificationCount",this.notifications.length),window.dispatchEvent(new Event("storage")),window.dispatchEvent(new Event("notification-updated"))},markAllRead(){this.readNotifications=[...this.readNotifications,...this.notifications],this.notifications=[],this.updateNotificationCount()}},watch:{notifications:{handler(){this.updateNotificationCount()},deep:!0,immediate:!0},readNotifications:{handler(){this.updateNotificationCount()},deep:!0}},mounted(){(E["default"].get("showDashboardWelcome")||"GetNotification"===this.$route.name||"Notifications"===this.$route.name)&&(this.fetchNotifications(),E["default"].remove("showDashboardWelcome"))}};var $=a(6262);const X=(0,$.A)(x,[["render",N],["__scopeId","data-v-1250b027"]]),F=X}}]);
//# sourceMappingURL=30.b4907280.js.map