"use strict";(self["webpackChunkdolphin"]=self["webpackChunkdolphin"]||[]).push([[626],{626:(e,a,t)=>{t.r(a),t.d(a,{default:()=>k});var s=t(641),r=t(3751),i=t(33);const o={class:"page"},l={class:"lead-capture-outer"},n={class:"lead-capture-card"},d={class:"org-edit-actions"};function u(e,a,t,u,m,c){const h=(0,s.g2)("FormLabel"),f=(0,s.g2)("FormInput"),_=(0,s.g2)("FormRow"),p=(0,s.g2)("FormDropdown"),g=(0,s.g2)("MainLayout");return(0,s.uX)(),(0,s.Wv)(g,null,{default:(0,s.k6)(()=>[(0,s.Lk)("div",o,[(0,s.Lk)("div",l,[(0,s.Lk)("div",n,[a[30]||(a[30]=(0,s.Lk)("h3",{class:"lead-capture-card-title"},"Edit Lead",-1)),(0,s.Lk)("form",{class:"lead-capture-form",onSubmit:a[13]||(a[13]=(0,r.D$)((...e)=>c.handleUpdateLead&&c.handleUpdateLead(...e),["prevent"]))},[(0,s.bF)(_,null,{default:(0,s.k6)(()=>[(0,s.Lk)("div",null,[(0,s.bF)(h,null,{default:(0,s.k6)(()=>[...a[14]||(a[14]=[(0,s.eW)("First Name",-1)])]),_:1}),(0,s.bF)(f,{modelValue:m.form.first_name,"onUpdate:modelValue":a[0]||(a[0]=e=>m.form.first_name=e),icon:"fas fa-user",placeholder:"Type here",required:""},null,8,["modelValue"]),m.errors.firstName?((0,s.uX)(),(0,s.Wv)(h,{key:0,class:"error-message"},{default:(0,s.k6)(()=>[(0,s.eW)((0,i.v_)(m.errors.firstName[0]),1)]),_:1})):(0,s.Q3)("",!0)]),(0,s.Lk)("div",null,[(0,s.bF)(h,null,{default:(0,s.k6)(()=>[...a[15]||(a[15]=[(0,s.eW)("Last Name",-1)])]),_:1}),(0,s.bF)(f,{modelValue:m.form.last_name,"onUpdate:modelValue":a[1]||(a[1]=e=>m.form.last_name=e),icon:"fas fa-user",placeholder:"Type here",required:""},null,8,["modelValue"]),m.errors.lastName?((0,s.uX)(),(0,s.Wv)(h,{key:0,class:"error-message"},{default:(0,s.k6)(()=>[(0,s.eW)((0,i.v_)(m.errors.lastName[0]),1)]),_:1})):(0,s.Q3)("",!0)]),(0,s.Lk)("div",null,[(0,s.bF)(h,null,{default:(0,s.k6)(()=>[...a[16]||(a[16]=[(0,s.eW)("Email",-1)])]),_:1}),(0,s.bF)(f,{modelValue:m.form.email,"onUpdate:modelValue":a[2]||(a[2]=e=>m.form.email=e),icon:"fas fa-envelope",type:"email",placeholder:"abc@gmail.com",required:""},null,8,["modelValue"]),m.errors.email?((0,s.uX)(),(0,s.Wv)(h,{key:0,class:"error-message"},{default:(0,s.k6)(()=>[(0,s.eW)((0,i.v_)(m.errors.email[0]),1)]),_:1})):(0,s.Q3)("",!0)])]),_:1}),(0,s.bF)(_,null,{default:(0,s.k6)(()=>[(0,s.Lk)("div",null,[(0,s.bF)(h,null,{default:(0,s.k6)(()=>[...a[17]||(a[17]=[(0,s.eW)("Phone",-1)])]),_:1}),(0,s.bF)(f,{modelValue:m.form.phone,"onUpdate:modelValue":a[3]||(a[3]=e=>m.form.phone=e),icon:"fas fa-phone",placeholder:"Type here",required:""},null,8,["modelValue"]),m.errors.phone?((0,s.uX)(),(0,s.Wv)(h,{key:0,class:"error-message"},{default:(0,s.k6)(()=>[(0,s.eW)((0,i.v_)(m.errors.phone[0]),1)]),_:1})):(0,s.Q3)("",!0)]),(0,s.Lk)("div",null,[(0,s.bF)(h,null,{default:(0,s.k6)(()=>[...a[18]||(a[18]=[(0,s.eW)("How did you find us?",-1)])]),_:1}),(0,s.bF)(p,{modelValue:m.form.find_us,"onUpdate:modelValue":a[4]||(a[4]=e=>m.form.find_us=e),icon:"fas fa-search",options:[{value:null,text:"Select",disabled:!0},...m.findUsOptions.map(e=>({value:e,text:e}))],required:""},null,8,["modelValue","options"]),m.errors.findUs?((0,s.uX)(),(0,s.Wv)(h,{key:0,class:"error-message"},{default:(0,s.k6)(()=>[(0,s.eW)((0,i.v_)(m.errors.find_us[0]),1)]),_:1})):(0,s.Q3)("",!0)]),a[19]||(a[19]=(0,s.Lk)("div",null,null,-1))]),_:1}),(0,s.bF)(_,null,{default:(0,s.k6)(()=>[(0,s.Lk)("div",null,[(0,s.bF)(h,null,{default:(0,s.k6)(()=>[...a[20]||(a[20]=[(0,s.eW)("Organization Name",-1)])]),_:1}),(0,s.bF)(f,{modelValue:m.form.organization_name,"onUpdate:modelValue":a[5]||(a[5]=e=>m.form.organization_name=e),icon:"fas fa-cog",placeholder:"Organization Name",required:""},null,8,["modelValue"]),m.errors.organization_name?((0,s.uX)(),(0,s.Wv)(h,{key:0,class:"error-message"},{default:(0,s.k6)(()=>[(0,s.eW)((0,i.v_)(m.errors.organization_name[0]),1)]),_:1})):(0,s.Q3)("",!0)]),(0,s.Lk)("div",null,[(0,s.bF)(h,null,{default:(0,s.k6)(()=>[...a[21]||(a[21]=[(0,s.eW)("Organization Size",-1)])]),_:1}),(0,s.bF)(p,{modelValue:m.form.organization_size,"onUpdate:modelValue":a[6]||(a[6]=e=>m.form.organization_size=e),icon:"fas fa-users",options:[{value:null,text:"Select",disabled:!0},...m.orgSizeOptions.map(e=>({value:e,text:e}))],required:""},null,8,["modelValue","options"]),m.errors.organization_size?((0,s.uX)(),(0,s.Wv)(h,{key:0,class:"error-message"},{default:(0,s.k6)(()=>[(0,s.eW)((0,i.v_)(m.errors.organization_size[0]),1)]),_:1})):(0,s.Q3)("",!0)]),a[22]||(a[22]=(0,s.Lk)("div",null,null,-1))]),_:1}),(0,s.bF)(_,null,{default:(0,s.k6)(()=>[(0,s.Lk)("div",null,[(0,s.bF)(h,null,{default:(0,s.k6)(()=>[...a[23]||(a[23]=[(0,s.eW)("Address ",-1)])]),_:1}),(0,s.bF)(f,{modelValue:m.form.address,"onUpdate:modelValue":a[7]||(a[7]=e=>m.form.address=e),icon:"fas fa-map-marker-alt",placeholder:"Enter address",required:""},null,8,["modelValue"]),m.errors.address?((0,s.uX)(),(0,s.Wv)(h,{key:0,class:"error-message"},{default:(0,s.k6)(()=>[(0,s.eW)((0,i.v_)(m.errors.address[0]),1)]),_:1})):(0,s.Q3)("",!0)]),(0,s.Lk)("div",null,[(0,s.bF)(h,null,{default:(0,s.k6)(()=>[...a[24]||(a[24]=[(0,s.eW)("Country",-1)])]),_:1}),(0,s.bF)(p,{modelValue:m.form.country_id,"onUpdate:modelValue":a[8]||(a[8]=e=>m.form.country_id=e),icon:"fas fa-globe",onChange:c.onCountryChange,options:[{value:null,text:"Select",disabled:!0},...m.countries.map(e=>({value:e.id,text:e.name}))],required:""},null,8,["modelValue","onChange","options"]),m.errors.country_id?((0,s.uX)(),(0,s.Wv)(h,{key:0,class:"error-message"},{default:(0,s.k6)(()=>[(0,s.eW)((0,i.v_)(m.errors.country_id[0]),1)]),_:1})):(0,s.Q3)("",!0)]),(0,s.Lk)("div",null,[(0,s.bF)(h,null,{default:(0,s.k6)(()=>[...a[25]||(a[25]=[(0,s.eW)("State",-1)])]),_:1}),(0,s.bF)(p,{modelValue:m.form.state_id,"onUpdate:modelValue":a[9]||(a[9]=e=>m.form.state_id=e),icon:"fas fa-map-marker-alt",onChange:c.onStateChange,options:[{value:null,text:"Select",disabled:!0},...m.states.map(e=>({value:e.id,text:e.name}))],required:""},null,8,["modelValue","onChange","options"]),m.errors.state_id?((0,s.uX)(),(0,s.Wv)(h,{key:0,class:"error-message"},{default:(0,s.k6)(()=>[(0,s.eW)((0,i.v_)(m.errors.state_id[0]),1)]),_:1})):(0,s.Q3)("",!0)])]),_:1}),(0,s.bF)(_,null,{default:(0,s.k6)(()=>[(0,s.Lk)("div",null,[(0,s.bF)(h,null,{default:(0,s.k6)(()=>[...a[26]||(a[26]=[(0,s.eW)("City",-1)])]),_:1}),(0,s.bF)(p,{modelValue:m.form.city_id,"onUpdate:modelValue":a[10]||(a[10]=e=>m.form.city_id=e),icon:"fas fa-map-marker-alt",options:[{value:null,text:"Select",disabled:!0},...m.cities.map(e=>({value:e.id,text:e.name}))],required:""},null,8,["modelValue","options"]),m.errors.city_id?((0,s.uX)(),(0,s.Wv)(h,{key:0,class:"error-message"},{default:(0,s.k6)(()=>[(0,s.eW)((0,i.v_)(m.errors.city_id[0]),1)]),_:1})):(0,s.Q3)("",!0)]),(0,s.Lk)("div",null,[(0,s.bF)(h,null,{default:(0,s.k6)(()=>[...a[27]||(a[27]=[(0,s.eW)("Zip Code",-1)])]),_:1}),(0,s.bF)(f,{modelValue:m.form.zip,"onUpdate:modelValue":a[11]||(a[11]=e=>m.form.zip=e),icon:"fas fa-map-marker-alt",placeholder:"Enter PIN code",required:""},null,8,["modelValue"]),m.errors.zip?((0,s.uX)(),(0,s.Wv)(h,{key:0,class:"error-message"},{default:(0,s.k6)(()=>[(0,s.eW)((0,i.v_)(m.errors.zip[0]),1)]),_:1})):(0,s.Q3)("",!0)]),a[28]||(a[28]=(0,s.Lk)("div",null,null,-1))]),_:1}),(0,s.Lk)("div",d,[(0,s.Lk)("button",{type:"button",class:"org-edit-cancel",onClick:a[12]||(a[12]=a=>e.$router.push("/leads"))}," Cancel "),a[29]||(a[29]=(0,s.Lk)("button",{type:"submit",class:"org-edit-update"}," Update Lead ",-1))])],32)])])])]),_:1})}var m=t(4631),c=t(2281),h=t(3270),f=t(4335);const _={name:"EditLead",components:{MainLayout:m.A,FormRow:c.fh,FormLabel:c.lR,FormInput:c.ZQ,FormDropdown:c.ad,FormBox:c.CQ},data(){return{findUsOptions:h.ch,orgSizeOptions:h.w6,form:{first_name:"",last_name:"",email:"",phone:"",find_us:"",organization_name:"",organization_size:"",address:"",country_id:null,state_id:null,city_id:null,zip:""},countries:[],states:[],cities:[],loading:!1,successMessage:"",errorMessage:"",errors:{}}},async created(){await this.fetchCountries();const e=this.getLeadId();if(e){const a=await this.loadLeadFromApi(e);if(a)return}this.loadLeadFromQuery()},methods:{getLeadId(){const e=this.$route.query;return this.$route.params.id||e.id||null},async loadLeadFromApi(e){try{const a="http://127.0.0.1:8000",s=t(3193)["default"],r=s.get("authToken"),i=await f.A.get(`${a}/api/leads/${e}`,{headers:{Authorization:`Bearer ${r}`}}),o=i.data||{},l=o.lead||o;return!!l&&(this.fillForm(l),this.form.country_id&&await this.fetchStates(),this.form.state_id&&await this.fetchCities(),this.updatePageTitle(l),!0)}catch(a){return console.error("Error fetching lead data:",a),!1}},loadLeadFromQuery(){const e=this.$route.query;let a={};if(e.lead)try{a="string"===typeof e.lead?JSON.parse(e.lead):e.lead}catch(t){console.error("Failed to parse lead query param:",t)}this.fillForm({first_name:e.first_name||e.contact?.split(" ")[0],last_name:e.last_name||e.contact?.split(" ")[1],email:e.email,phone:e.phone,find_us:e.source||e.find_us,organization_name:e.organization||e.organization_name,organization_size:e.size||e.organization_size,address:e.address||e.address_line,country_id:e.country_id,state_id:e.state_id,city_id:e.city_id,zip:e.zip,...a}),this.form.country_id&&this.fetchStates(),this.form.state_id&&this.fetchCities()},fillForm(e){this.form={first_name:e.first_name||"",last_name:e.last_name||"",email:e.email||"",phone:e.phone||"",find_us:e.find_us||"",organization_name:e.organization_name||"",organization_size:e.organization_size||"",address:e.address||e.address_line||"",country_id:e.country_id||null,state_id:e.state_id||null,city_id:e.city_id||null,zip:e.zip||""}},updatePageTitle(e){this.$nextTick(()=>{const a=`${e.first_name||""} ${e.last_name||""}`.trim();this.$root?.$emit("page-title-override",a?`Edit Lead : ${a}`:"Edit Lead")})},async fetchCountries(){const e="http://127.0.0.1:8000",a=await f.A.get(`${e}/api/countries`);this.countries=a.data},async fetchStates(){if(!this.form.country_id)return void(this.states=[]);const e="http://127.0.0.1:8000",a=await f.A.get(`${e}/api/states?country_id=${this.form.country_id}`);this.states=a.data},async fetchCities(){if(!this.form.state_id)return void(this.cities=[]);const e="http://127.0.0.1:8000",a=await f.A.get(`${e}/api/cities?state_id=${this.form.state_id}`);this.cities=a.data},onCountryChange(){let e=this.form.country_id;if(null!==e&&""!==e&&"number"!==typeof e){const a=Number(e);isNaN(a)||(this.form.country_id=a,e=a)}e&&"number"===typeof e?(this.form.state_id=null,this.form.city_id=null,this.states=[],this.cities=[],this.fetchStates()):(this.form.state_id=null,this.form.city_id=null,this.states=[],this.cities=[])},onStateChange(){let e=this.form.state_id;if(null!==e&&""!==e&&"number"!==typeof e){const a=Number(e);isNaN(a)||(this.form.state_id=a,e=a)}e&&"number"===typeof e?(this.form.city_id=null,this.cities=[],this.fetchCities()):(this.form.city_id=null,this.cities=[])},async handleUpdateLead(){this.resetMessages(),this.loading=!0;try{const e=this.getAuthToken();if(!e)return this.handleAuthError();const a=this.getLeadId();if(!a)return this.handleMissingId();const t=await this.updateLeadApi(a,e,this.form);this.handleSuccess(t.data)}catch(e){this.handleError(e)}finally{this.loading=!1}},resetMessages(){this.successMessage="",this.errorMessage="",this.errors={}},getAuthToken(){const e=t(3193)["default"];return e.get("authToken")},handleAuthError(){this.errorMessage="Authentication token not found. Please log in.",this.showToast("error","Authentication Error",this.errorMessage),this.loading=!1},handleMissingId(){this.errorMessage="Lead ID not found in route query.",this.showToast("error","Error",this.errorMessage),this.loading=!1},async updateLeadApi(e,a,t){const s="http://127.0.0.1:8000";return f.A.patch(`${s}/api/leads/${e}`,t,{headers:{Authorization:`Bearer ${a}`}})},handleSuccess(e){this.successMessage=e.message||"Lead updated successfully!",this.showToast("success","Success",this.successMessage),this.$router.push("/leads")},handleError(e){if(console.error("Error updating lead:",e),e.response?.data){const{message:a,errors:t}=e.response.data;this.errorMessage=a||"Failed to update lead.",this.errors=t||{}}else this.errorMessage="An unexpected error occurred.";this.showToast("error","Validation Error",this.errorMessage)},showToast(e,a,t,s=5e3){this.$toast.add({severity:e,summary:a,detail:t,life:s})}}};var p=t(6262);const g=(0,p.A)(_,[["render",u],["__scopeId","data-v-8efbd32c"]]),k=g}}]);
//# sourceMappingURL=626.75fcef0a.js.map