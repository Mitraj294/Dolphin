"use strict";(self["webpackChunkdolphin"]=self["webpackChunkdolphin"]||[]).push([[44],{5044:(e,t,a)=>{a.r(t),a.d(t,{default:()=>$});var r=a(641),l=a(33),i=a(3751);const s={class:"page"},o={class:"lead-capture-outer"},n={class:"lead-capture-card"},d={class:"org-detail-main-card-header-title",style:{"font-family":"'Helvetica Neue LT Std', Helvetica, Arial, sans-serif","font-weight":"600","font-size":"24px",color:"#222"}},u={class:"org-edit-actions"};function c(e,t,a,c,m,f){const _=(0,r.g2)("FormLabel"),h=(0,r.g2)("FormInput"),p=(0,r.g2)("FormDropdown"),g=(0,r.g2)("FormRow"),k=(0,r.g2)("MainLayout");return(0,r.uX)(),(0,r.Wv)(k,null,{default:(0,r.k6)(()=>[(0,r.Lk)("div",s,[(0,r.Lk)("div",o,[(0,r.Lk)("div",n,[(0,r.Lk)("div",d," Edit Organization : "+(0,l.v_)(m.form.organization_name),1),(0,r.Lk)("form",{class:"lead-capture-form",onSubmit:t[20]||(t[20]=(0,i.D$)((...e)=>f.updateDetails&&f.updateDetails(...e),["prevent"]))},[(0,r.bF)(g,null,{default:(0,r.k6)(()=>[(0,r.Lk)("div",null,[(0,r.bF)(_,null,{default:(0,r.k6)(()=>[...t[21]||(t[21]=[(0,r.eW)("Organization Name",-1)])]),_:1}),(0,r.bF)(h,{modelValue:m.form.organization_name,"onUpdate:modelValue":t[0]||(t[0]=e=>m.form.organization_name=e),icon:"fas fa-cog",placeholder:"Organization Name"},null,8,["modelValue"]),m.errors.organization_name?((0,r.uX)(),(0,r.Wv)(_,{key:0,class:"error-message"},{default:(0,r.k6)(()=>[(0,r.eW)((0,l.v_)(m.errors.organization_name[0]),1)]),_:1})):(0,r.Q3)("",!0)]),(0,r.Lk)("div",null,[(0,r.bF)(_,null,{default:(0,r.k6)(()=>[...t[22]||(t[22]=[(0,r.eW)("Organization Size",-1)])]),_:1}),(0,r.bF)(p,{modelValue:m.form.organization_size,"onUpdate:modelValue":t[1]||(t[1]=e=>m.form.organization_size=e),icon:"fas fa-users",options:[{value:"",text:"Select ",disabled:!0},{value:"250+ Employees (Large)",text:"250+ Employees (Large)"},{value:"100-249 Employees (Medium)",text:"100-249 Employees (Medium)"},{value:"1-99 Employees (Small)",text:"1-99 Employees (Small)"}]},null,8,["modelValue"]),m.errors.organization_size?((0,r.uX)(),(0,r.Wv)(_,{key:0,class:"error-message"},{default:(0,r.k6)(()=>[(0,r.eW)((0,l.v_)(m.errors.organization_size[0]),1)]),_:1})):(0,r.Q3)("",!0)]),(0,r.Lk)("div",null,[(0,r.bF)(_,null,{default:(0,r.k6)(()=>[...t[23]||(t[23]=[(0,r.eW)("Source",-1)])]),_:1}),(0,r.bF)(p,{modelValue:m.form.source,"onUpdate:modelValue":t[2]||(t[2]=e=>m.form.source=e),icon:"fas fa-bullhorn",options:[{value:"",text:"Select",disabled:!0},{value:"Google",text:"Google"},{value:"Friend",text:"Friend"},{value:"Colleague",text:"Colleague"},{value:"Other",text:"Other"}]},null,8,["modelValue"]),m.errors.source?((0,r.uX)(),(0,r.Wv)(_,{key:0,class:"error-message"},{default:(0,r.k6)(()=>[(0,r.eW)((0,l.v_)(m.errors.source[0]),1)]),_:1})):(0,r.Q3)("",!0)])]),_:1}),(0,r.bF)(g,null,{default:(0,r.k6)(()=>[(0,r.Lk)("div",null,[(0,r.bF)(_,null,{default:(0,r.k6)(()=>[...t[24]||(t[24]=[(0,r.eW)("Country",-1)])]),_:1}),(0,r.bF)(p,{modelValue:m.form.country_id,"onUpdate:modelValue":t[3]||(t[3]=e=>m.form.country_id=e),icon:"fas fa-globe",onChange:f.onCountryChange,options:[{value:null,text:"Select",disabled:!0},...m.countries.map(e=>({value:e.id,text:e.name}))]},null,8,["modelValue","onChange","options"]),m.errors.country_id?((0,r.uX)(),(0,r.Wv)(_,{key:0,class:"error-message"},{default:(0,r.k6)(()=>[(0,r.eW)((0,l.v_)(m.errors.country_id[0]),1)]),_:1})):(0,r.Q3)("",!0)]),(0,r.Lk)("div",null,[(0,r.bF)(_,null,{default:(0,r.k6)(()=>[...t[25]||(t[25]=[(0,r.eW)("State",-1)])]),_:1}),(0,r.bF)(p,{modelValue:m.form.state_id,"onUpdate:modelValue":t[4]||(t[4]=e=>m.form.state_id=e),icon:"fas fa-map-marker-alt",onChange:f.onStateChange,options:[{value:null,text:"Select",disabled:!0},...m.states.map(e=>({value:e.id,text:e.name}))]},null,8,["modelValue","onChange","options"]),m.errors.state_id?((0,r.uX)(),(0,r.Wv)(_,{key:0,class:"error-message"},{default:(0,r.k6)(()=>[(0,r.eW)((0,l.v_)(m.errors.state_id[0]),1)]),_:1})):(0,r.Q3)("",!0)]),(0,r.Lk)("div",null,[(0,r.bF)(_,null,{default:(0,r.k6)(()=>[...t[26]||(t[26]=[(0,r.eW)("City",-1)])]),_:1}),(0,r.bF)(p,{modelValue:m.form.city_id,"onUpdate:modelValue":t[5]||(t[5]=e=>m.form.city_id=e),icon:"fas fa-map-marker-alt",options:[{value:null,text:"Select",disabled:!0},...m.cities.map(e=>({value:e.id,text:e.name}))]},null,8,["modelValue","options"]),m.errors.city_id?((0,r.uX)(),(0,r.Wv)(_,{key:0,class:"error-message"},{default:(0,r.k6)(()=>[(0,r.eW)((0,l.v_)(m.errors.city_id[0]),1)]),_:1})):(0,r.Q3)("",!0)])]),_:1}),(0,r.bF)(g,null,{default:(0,r.k6)(()=>[(0,r.Lk)("div",null,[(0,r.bF)(_,null,{default:(0,r.k6)(()=>[...t[27]||(t[27]=[(0,r.eW)("Address",-1)])]),_:1}),(0,r.bF)(h,{modelValue:m.form.address,"onUpdate:modelValue":t[6]||(t[6]=e=>m.form.address=e),icon:"fas fa-map-marker-alt",placeholder:"Enter address"},null,8,["modelValue"]),m.errors.address?((0,r.uX)(),(0,r.Wv)(_,{key:0,class:"error-message"},{default:(0,r.k6)(()=>[(0,r.eW)((0,l.v_)(m.errors.address[0]),1)]),_:1})):(0,r.Q3)("",!0)]),(0,r.Lk)("div",null,[(0,r.bF)(_,null,{default:(0,r.k6)(()=>[...t[28]||(t[28]=[(0,r.eW)("PIN",-1)])]),_:1}),(0,r.bF)(h,{modelValue:m.form.zip,"onUpdate:modelValue":t[7]||(t[7]=e=>m.form.zip=e),icon:"fas fa-map-pin",placeholder:"Enter PIN code"},null,8,["modelValue"]),m.errors.zip?((0,r.uX)(),(0,r.Wv)(_,{key:0,class:"error-message"},{default:(0,r.k6)(()=>[(0,r.eW)((0,l.v_)(m.errors.zip[0]),1)]),_:1})):(0,r.Q3)("",!0)]),(0,r.Lk)("div",null,[(0,r.bF)(_,null,{default:(0,r.k6)(()=>[...t[29]||(t[29]=[(0,r.eW)("Â ",-1)])]),_:1})])]),_:1}),(0,r.bF)(g,null,{default:(0,r.k6)(()=>[(0,r.Lk)("div",null,[(0,r.bF)(_,null,{default:(0,r.k6)(()=>[...t[30]||(t[30]=[(0,r.eW)("Contract Start",-1)])]),_:1}),(0,r.Lk)("div",{class:"disabled-clickable",onClick:t[9]||(t[9]=(...t)=>e.onDisabledClick&&e.onDisabledClick(...t))},[(0,r.bF)(h,{modelValue:m.form.contractStart,"onUpdate:modelValue":t[8]||(t[8]=e=>m.form.contractStart=e),icon:"fas fa-calendar-alt",disabled:""},null,8,["modelValue"])])]),(0,r.Lk)("div",null,[(0,r.bF)(_,null,{default:(0,r.k6)(()=>[...t[31]||(t[31]=[(0,r.eW)("Contract End",-1)])]),_:1}),(0,r.Lk)("div",{class:"disabled-clickable",onClick:t[11]||(t[11]=(...t)=>e.onDisabledClick&&e.onDisabledClick(...t))},[(0,r.bF)(h,{modelValue:m.form.contractEnd,"onUpdate:modelValue":t[10]||(t[10]=e=>m.form.contractEnd=e),icon:"fas fa-calendar-alt",disabled:""},null,8,["modelValue"])])]),(0,r.Lk)("div",null,[(0,r.bF)(_,null,{default:(0,r.k6)(()=>[...t[32]||(t[32]=[(0,r.eW)("Last Contacted",-1)])]),_:1}),(0,r.Lk)("div",{class:"disabled-clickable",onClick:t[13]||(t[13]=(...t)=>e.onDisabledClick&&e.onDisabledClick(...t))},[(0,r.bF)(h,{modelValue:m.form.lastContacted,"onUpdate:modelValue":t[12]||(t[12]=e=>m.form.lastContacted=e),icon:"fas fa-history",disabled:"",placeholder:"Last contacted date"},null,8,["modelValue"])])])]),_:1}),t[40]||(t[40]=(0,r.Lk)("div",{class:"org-edit-divider"},null,-1)),(0,r.bF)(g,null,{default:(0,r.k6)(()=>[(0,r.Lk)("div",null,[(0,r.bF)(_,null,{default:(0,r.k6)(()=>[...t[33]||(t[33]=[(0,r.eW)("First Name",-1)])]),_:1}),(0,r.bF)(h,{modelValue:m.form.firstName,"onUpdate:modelValue":t[14]||(t[14]=e=>m.form.firstName=e),icon:"fas fa-user",placeholder:"Enter first name"},null,8,["modelValue"]),m.errors.first_name?((0,r.uX)(),(0,r.Wv)(_,{key:0,class:"error-message"},{default:(0,r.k6)(()=>[(0,r.eW)((0,l.v_)(m.errors.first_name[0]),1)]),_:1})):(0,r.Q3)("",!0)]),(0,r.Lk)("div",null,[(0,r.bF)(_,null,{default:(0,r.k6)(()=>[...t[34]||(t[34]=[(0,r.eW)("Last Name",-1)])]),_:1}),(0,r.bF)(h,{modelValue:m.form.lastName,"onUpdate:modelValue":t[15]||(t[15]=e=>m.form.lastName=e),icon:"fas fa-user",placeholder:"Enter last name"},null,8,["modelValue"]),m.errors.last_name?((0,r.uX)(),(0,r.Wv)(_,{key:0,class:"error-message"},{default:(0,r.k6)(()=>[(0,r.eW)((0,l.v_)(m.errors.last_name[0]),1)]),_:1})):(0,r.Q3)("",!0)]),(0,r.Lk)("div",null,[(0,r.bF)(_,null,{default:(0,r.k6)(()=>[...t[35]||(t[35]=[(0,r.eW)("Admin Email",-1)])]),_:1}),(0,r.bF)(h,{modelValue:m.form.adminEmail,"onUpdate:modelValue":t[16]||(t[16]=e=>m.form.adminEmail=e),icon:"fas fa-envelope",type:"email",placeholder:"Admin email"},null,8,["modelValue"]),m.errors.admin_email?((0,r.uX)(),(0,r.Wv)(_,{key:0,class:"error-message"},{default:(0,r.k6)(()=>[(0,r.eW)((0,l.v_)(m.errors.admin_email[0]),1)]),_:1})):(0,r.Q3)("",!0)])]),_:1}),(0,r.bF)(g,null,{default:(0,r.k6)(()=>[(0,r.Lk)("div",null,[(0,r.bF)(_,null,{default:(0,r.k6)(()=>[...t[36]||(t[36]=[(0,r.eW)("Admin Phone",-1)])]),_:1}),(0,r.bF)(h,{modelValue:m.form.adminPhone,"onUpdate:modelValue":t[17]||(t[17]=e=>m.form.adminPhone=e),icon:"fas fa-phone",placeholder:"Admin phone"},null,8,["modelValue"]),m.errors.admin_phone?((0,r.uX)(),(0,r.Wv)(_,{key:0,class:"error-message"},{default:(0,r.k6)(()=>[(0,r.eW)((0,l.v_)(m.errors.admin_phone[0]),1)]),_:1})):(0,r.Q3)("",!0)]),(0,r.Lk)("div",null,[(0,r.bF)(_,null,{default:(0,r.k6)(()=>[...t[37]||(t[37]=[(0,r.eW)("Sales Person",-1)])]),_:1}),(0,r.bF)(p,{modelValue:m.form.sales_person_id,"onUpdate:modelValue":t[18]||(t[18]=e=>m.form.sales_person_id=e),icon:"fas fa-user-tie",options:[{value:null,text:"Select",disabled:!0},...m.salesPersons.map(e=>({value:e.id,text:e.name||e.email}))]},null,8,["modelValue","options"]),m.errors.sales_person_id?((0,r.uX)(),(0,r.Wv)(_,{key:0,class:"error-message"},{default:(0,r.k6)(()=>[(0,r.eW)((0,l.v_)(m.errors.sales_person_id[0]),1)]),_:1})):(0,r.Q3)("",!0)]),(0,r.Lk)("div",null,[(0,r.bF)(_,null,{default:(0,r.k6)(()=>[...t[38]||(t[38]=[(0,r.eW)("Certified Staff",-1)])]),_:1}),(0,r.bF)(h,{value:m.form.certifiedStaff,icon:"fas fa-users",type:"number",disabled:""},null,8,["value"]),m.errors.certified_staff?((0,r.uX)(),(0,r.Wv)(_,{key:0,class:"error-message"},{default:(0,r.k6)(()=>[(0,r.eW)((0,l.v_)(m.errors.certified_staff[0]),1)]),_:1})):(0,r.Q3)("",!0)])]),_:1}),(0,r.Lk)("div",u,[(0,r.Lk)("button",{type:"button",class:"org-edit-cancel",onClick:t[19]||(t[19]=t=>e.$router.back())}," Cancel "),t[39]||(t[39]=(0,r.Lk)("button",{type:"submit",class:"org-edit-update"}," Update Details ",-1))])],32)])])])]),_:1})}var m=a(4631),f=a(2281),_=a(4335),h=a(3193);const p="http://127.0.0.1:8000";function g(){const e=h["default"].get("authToken");return e?{Authorization:`Bearer ${e}`}:{}}function k(e){try{const t=new Date(e);if(isNaN(t.getTime()))return e;const a=String(t.getDate()).padStart(2,"0"),r=t.toLocaleString("en-GB",{month:"short"}).toUpperCase(),l=t.getFullYear();return`${a} ${r},${l}`}catch{return e}}function v(e){try{const t=new Date(e);if(isNaN(t.getTime()))return e;const a=String(t.getDate()).padStart(2,"0"),r=t.toLocaleString("en-GB",{month:"short"}).toUpperCase(),l=t.getFullYear();let i=t.getHours();const s=String(t.getMinutes()).padStart(2,"0"),o=i>=12?"PM":"AM";return i=i%12||12,`${a} ${r},${l} ${i}:${s} ${o}`}catch{return e}}function y(e){if(!e)return null;try{const t=new Date(e);return isNaN(t.getTime())?null:t.toISOString().slice(0,19).replace("T"," ")}catch{return null}}function b(e){if(!e)return null;try{const t=new Date(e);if(isNaN(t.getTime()))return null;const a=t.getUTCFullYear(),r=String(t.getUTCMonth()+1).padStart(2,"0"),l=String(t.getUTCDate()).padStart(2,"0"),i=String(t.getUTCHours()).padStart(2,"0"),s=String(t.getUTCMinutes()).padStart(2,"0"),o=String(t.getUTCSeconds()).padStart(2,"0");return`${a}-${r}-${l} ${i}:${s}:${o}`}catch{return null}}function F(e){const t=e.user||{},a=t.user_details||{};return{organization_name:e.organization_name||"",organization_size:e.organization_size||"",source:e.source||e.find_us||a.find_us||"",address:e.address||a.address||"",zip:e.zip||a.zip||"",country_id:e.country_id||a.country_id||null,state_id:e.state_id||a.state_id||null,city_id:e.city_id||a.city_id||null,contractStart:e.contract_start?k(e.contract_start):"",contractEnd:e.contract_end?k(e.contract_end):"",firstName:t.first_name||e.first_name||(e.main_contact||"").split(" ")[0]||"",lastName:t.last_name||e.last_name||(e.main_contact||"").split(" ").slice(1).join(" ")||"",adminEmail:t.email||e.admin_email||"",adminPhone:a.phone||e.admin_phone||"",sales_person_id:e.sales_person_id||null,lastContacted:e.last_contacted?v(e.last_contacted):"",certifiedStaff:e.certified_staff||a.certified_staff||"0"}}function z(e){return{organization_name:e.organization_name,organization_size:e.organization_size||null,source:e.source||null,address:e.address||null,city_id:e.city_id||null,state_id:e.state_id||null,zip:e.zip||null,country_id:e.country_id||null,sales_person_id:e.sales_person_id||null,certified_staff:e.certifiedStaff||null,first_name:e.firstName||null,last_name:e.lastName||null,admin_email:e.adminEmail||null,admin_phone:e.adminPhone||null,main_contact:`${e.firstName} ${e.lastName}`.trim(),contract_start:y(e.contractStart),contract_end:y(e.contractEnd),last_contacted:b(e.lastContacted)}}const S={name:"OrganizationEdit",components:{MainLayout:m.A,FormRow:f.fh,FormLabel:f.lR,FormInput:f.ZQ,FormDropdown:f.ad},data(){return{form:{organization_name:"",organization_size:"",source:"",address:"",zip:"",country_id:null,state_id:null,city_id:null,contractStart:"",contractEnd:"",firstName:"",lastName:"",adminEmail:"",adminPhone:"",sales_person_id:null,lastContacted:"",certifiedStaff:""},errors:{},orgId:null,countries:[],states:[],cities:[],salesPersons:[]}},async mounted(){await this.fetchCountries(),await this.fetchOrganization(),this.$nextTick(()=>{const e=this.form.organization_name||this.$route.params.organization_name||"";this.$root&&this.$root.$emit&&this.$root.$emit("page-title-override",e?`Edit organization : ${e}`:"Edit organization")})},methods:{async fetchOrganization(){try{const e=this.$route.params.id;if(!e)return;const t=await _.A.get(`${p}/api/organizations/${e}`,{headers:g()});if(!t.data)return;this.orgId=t.data.id,this.form=F(t.data),this.form.country_id||(this.form.country_id=this._findIdByName(this.countries,t.data.country||t.data.country_name)),this.form.country_id&&(await this.fetchStates(),this.form.state_id||(this.form.state_id=this._findIdByName(this.states,t.data.state||t.data.state_name))),this.form.state_id&&(await this.fetchCities(),this.form.city_id||(this.form.city_id=this._findIdByName(this.cities,t.data.city||t.data.city_name))),t.data.sales_person?this.salesPersons=[{id:t.data.sales_person_id||null,name:t.data.sales_person}]:await this.fetchSalesPersons()}catch(e){console.error("Failed to fetch organization details",e)}},_findIdByName(e,t){if(!t||!e||!e.length)return null;const a=t.toString().trim().toLowerCase(),r=e.find(e=>e.name.toString().trim().toLowerCase()===a);return r?r.id:null},async updateDetails(){try{if(this.errors={},!this.orgId)return void this.$toast?.add({severity:"error",summary:"Update Failed",detail:"Organization not found.",life:3500});const e=z(this.form);await _.A.put(`${p}/api/organizations/${this.orgId}`,e,{headers:g()}),this.$toast?.add({severity:"success",summary:"Updated",detail:"Organization updated successfully.",life:3500}),this.$root?.$emit("page-title-override",null),this.$router.push(`/organizations/${this.orgId}`)}catch(e){if(console.error("Failed to update organization",e),e.response&&422===e.response.status&&e.response.data){this.errors=e.response.data.errors||{};const t=Object.keys(this.errors)[0],a=this.errors[t]?this.errors[t][0]:"Validation failed";return void this.$toast?.add({severity:"error",summary:"Validation Error",detail:a,life:6e3})}this.$toast?.add({severity:"error",summary:"Update Failed",detail:"Failed to update organization.",life:4500})}},errorText(e){if(!this.errors)return null;const t=e.replace(/[A-Z]/g,e=>`_${e.toLowerCase()}`);return this.errors[t]&&this.errors[t].length?this.errors[t][0]:this.errors[e]&&this.errors[e].length?this.errors[e][0]:null},async fetchCountries(){const e=await _.A.get(`${p}/api/countries`);this.countries=e.data},async fetchStates(){if(!this.form.country_id)return void(this.states=[]);const e=await _.A.get(`${p}/api/states?country_id=${this.form.country_id}`);this.states=e.data},async fetchCities(){if(!this.form.state_id)return void(this.cities=[]);const e=await _.A.get(`${p}/api/cities?state_id=${this.form.state_id}`);this.cities=e.data},async fetchSalesPersons(){try{const e=await _.A.get(`${p}/api/users`,{headers:g()}),t=e.data&&e.data.users||[];this.salesPersons=t.filter(e=>(e.roles||[]).some(e=>"salesperson"===e.name))}catch(e){console.warn("Failed to fetch sales persons",e),this.salesPersons=[]}},onCountryChange(){this.form.state_id=null,this.form.city_id=null,this.states=[],this.cities=[],this.fetchStates()},onStateChange(){this.form.city_id=null,this.cities=[],this.fetchCities()}}};var C=a(6262);const V=(0,C.A)(S,[["render",c],["__scopeId","data-v-0954e968"]]),$=V}}]);
//# sourceMappingURL=44.a0f3f71a.js.map