"use strict";(self["webpackChunkdolphin"]=self["webpackChunkdolphin"]||[]).push([[596],{8792:(e,t,r)=>{r.r(t),r.d(t,{default:()=>re});var a=r(641),s=r(3751),o=r(33),i=r(9586);const l={class:"page"},d={class:"table-outer"},n={class:"table-card"},m={class:"table-search-bar"},c={class:"table-container"},h={class:"table"},u={key:0},p={key:1},b=["onClick"],f={class:"modal-card",style:{"max-width":"800px",width:"90%"}},g={class:"profile-card"},M={class:"profile-header"},y={class:"profile-info-table"},k={class:"profile-info-row"},v={class:"profile-value"},_={class:"profile-info-row"},L={class:"profile-value"},w={class:"profile-info-row"},E={class:"profile-value"},F={class:"profile-info-row"},S={class:"profile-value"},A={key:0},P={key:1},$={class:"profile-info-row"},z={class:"profile-value"},C={class:"profile-info-row"},D={class:"profile-value"},W={key:0},R={key:1},I={class:"profile-info-row"},N={class:"profile-value"},x={class:"profile-actions"},X={class:"modal-card",style:{"max-width":"550px"}},V={class:"modal-form-actions"};function T(e,t,r,T,Q,U){const B=(0,a.g2)("ConfirmDialog"),q=(0,a.g2)("Toast"),K=(0,a.g2)("TableHeader"),j=(0,a.g2)("Pagination"),G=(0,a.g2)("FormLabel"),H=(0,a.g2)("FormInput"),J=(0,a.g2)("FormRow"),O=(0,a.g2)("MultiSelectDropdown"),Y=(0,a.g2)("MainLayout");return(0,a.uX)(),(0,a.CE)(a.FK,null,[(0,a.bF)(B),(0,a.bF)(q),(0,a.bF)(Y,null,{default:(0,a.k6)(()=>[(0,a.Lk)("div",l,[(0,a.Lk)("div",d,[Q.showMemberModal?(0,a.Q3)("",!0):((0,a.uX)(),(0,a.CE)(a.FK,{key:0},[(0,a.Lk)("div",n,[(0,a.Lk)("div",m,[(0,a.bo)((0,a.Lk)("input",{class:"org-search",placeholder:"Search Member...","onUpdate:modelValue":t[0]||(t[0]=e=>Q.searchQuery=e),onInput:t[1]||(t[1]=(...e)=>U.onSearch&&U.onSearch(...e))},null,544),[[s.Jo,Q.searchQuery]])]),(0,a.Lk)("div",c,[(0,a.Lk)("table",h,[(0,a.bF)(K,{columns:[{label:"Name",key:"name",minWidth:"200px"},{label:"Email",key:"email",minWidth:"200px"},{label:"Phone Number",key:"phone",minWidth:"150px"},{label:"Role",key:"role",minWidth:"150px"},{label:"Actions",key:"actions",minWidth:"100px"}],onSort:U.sortBy},null,8,["onSort"]),(0,a.Lk)("tbody",null,[Q.loading?((0,a.uX)(),(0,a.CE)("tr",u,[...t[15]||(t[15]=[(0,a.Lk)("td",{colspan:"5",class:"no-data"}," Loading members... ",-1)])])):0===U.paginatedMembers.length?((0,a.uX)(),(0,a.CE)("tr",p,[...t[16]||(t[16]=[(0,a.Lk)("td",{colspan:"5",class:"no-data"}," No members found. ",-1)])])):((0,a.uX)(!0),(0,a.CE)(a.FK,{key:2},(0,a.pI)(U.paginatedMembers,e=>((0,a.uX)(),(0,a.CE)("tr",{key:e.id},[(0,a.Lk)("td",null,(0,o.v_)(e.first_name)+" "+(0,o.v_)(e.last_name),1),(0,a.Lk)("td",null,(0,o.v_)(e.email),1),(0,a.Lk)("td",null,(0,o.v_)(e.phone),1),(0,a.Lk)("td",null,[(0,a.Lk)("span",null,(0,o.v_)(U.formatMemberRoles(e)),1)]),(0,a.Lk)("td",null,[(0,a.Lk)("button",{class:"btn-view",onClick:t=>U.openMemberModal(e)},[...t[17]||(t[17]=[(0,a.Lk)("img",{src:i,alt:"View",class:"btn-view-icon"},null,-1),(0,a.eW)(" View ",-1)])],8,b)])]))),128))])])])]),(0,a.bF)(j,{pageSize:Q.pageSize,pageSizes:[10,25,100],showPageDropdown:Q.showPageDropdown,currentPage:Q.currentPage,totalPages:U.totalPages,paginationPages:U.paginationPages,onGoToPage:U.goToPage,onSelectPageSize:U.selectPageSize,onTogglePageDropdown:t[2]||(t[2]=e=>Q.showPageDropdown=!Q.showPageDropdown)},null,8,["pageSize","showPageDropdown","currentPage","totalPages","paginationPages","onGoToPage","onSelectPageSize"])],64)),Q.showMemberModal?((0,a.uX)(),(0,a.CE)("div",{key:1,class:"modal-overlay",onClick:t[6]||(t[6]=(0,s.D$)((...e)=>U.closeMemberModal&&U.closeMemberModal(...e),["self"]))},[(0,a.Lk)("div",f,[(0,a.Lk)("button",{class:"modal-close-btn",onClick:t[3]||(t[3]=(...e)=>U.closeMemberModal&&U.closeMemberModal(...e))}," × "),t[29]||(t[29]=(0,a.Lk)("div",{class:"modal-title"},"Member Details",-1)),t[30]||(t[30]=(0,a.Lk)("div",{class:"modal-desc"},"Details for the selected member.",-1)),(0,a.Lk)("div",g,[(0,a.Lk)("div",M,[t[19]||(t[19]=(0,a.Lk)("div",{class:"profile-title"},[(0,a.Lk)("i",{class:"fas fa-user-circle profile-avatar"}),(0,a.Lk)("span",null,"Profile")],-1)),(0,a.Lk)("button",{class:"btn btn-primary",onClick:t[4]||(t[4]=(...e)=>U.openEditModal&&U.openEditModal(...e))},[...t[18]||(t[18]=[(0,a.Lk)("i",{class:"fas fa-pen-to-square"},null,-1),(0,a.eW)(" Edit ",-1)])])]),(0,a.Lk)("div",y,[(0,a.Lk)("div",k,[t[20]||(t[20]=(0,a.Lk)("div",{class:"profile-label"},"First Name",-1)),(0,a.Lk)("div",v,(0,o.v_)(Q.selectedMemberEdit.first_name||"Not provided"),1)]),(0,a.Lk)("div",_,[t[21]||(t[21]=(0,a.Lk)("div",{class:"profile-label"},"Last Name",-1)),(0,a.Lk)("div",L,(0,o.v_)(Q.selectedMemberEdit.last_name||"Not provided"),1)]),(0,a.Lk)("div",w,[t[22]||(t[22]=(0,a.Lk)("div",{class:"profile-label"},"Email",-1)),(0,a.Lk)("div",E,(0,o.v_)(Q.selectedMemberEdit.email),1)]),(0,a.Lk)("div",F,[t[23]||(t[23]=(0,a.Lk)("div",{class:"profile-label"},"Role",-1)),(0,a.Lk)("div",S,[Q.selectedMemberEdit.memberRoles&&Q.selectedMemberEdit.memberRoles.length>0?((0,a.uX)(),(0,a.CE)("span",A,(0,o.v_)(Q.selectedMemberEdit.memberRoles.map(e=>e.name).join(", ")),1)):((0,a.uX)(),(0,a.CE)("span",P,"No roles assigned"))])]),(0,a.Lk)("div",$,[t[24]||(t[24]=(0,a.Lk)("div",{class:"profile-label"},"Phone",-1)),(0,a.Lk)("div",z,(0,o.v_)(Q.selectedMemberEdit.phone||"Not provided"),1)]),(0,a.Lk)("div",C,[t[25]||(t[25]=(0,a.Lk)("div",{class:"profile-label"},"Groups",-1)),(0,a.Lk)("div",D,[Q.selectedMemberEdit.groups&&Q.selectedMemberEdit.groups.length>0||Q.selectedMemberEdit.group_ids&&Q.selectedMemberEdit.group_ids.length>0?((0,a.uX)(),(0,a.CE)("span",W,(0,o.v_)(U.formatMemberGroups(Q.selectedMemberEdit)),1)):((0,a.uX)(),(0,a.CE)("span",R,"No groups assigned"))])]),(0,a.Lk)("div",I,[t[26]||(t[26]=(0,a.Lk)("div",{class:"profile-label"},"Member ID",-1)),(0,a.Lk)("div",N,(0,o.v_)(Q.selectedMemberEdit.id),1)]),t[28]||(t[28]=(0,a.Lk)("div",{class:"profile-info-row"},null,-1)),(0,a.Lk)("div",x,[(0,a.Lk)("button",{class:"btn btn-danger",onClick:t[5]||(t[5]=e=>U.deleteMember(Q.selectedMemberEdit))},[...t[27]||(t[27]=[(0,a.Lk)("i",{class:"fas fa-trash"},null,-1),(0,a.eW)(" Delete Account ",-1)])])])])])])])):(0,a.Q3)("",!0),Q.showEditModal?((0,a.uX)(),(0,a.CE)("div",{key:2,class:"modal-overlay",onClick:t[14]||(t[14]=(0,s.D$)(e=>Q.showEditModal=!1,["self"]))},[(0,a.Lk)("div",X,[(0,a.Lk)("button",{class:"modal-close-btn",onClick:t[7]||(t[7]=e=>Q.showEditModal=!1)}," × "),t[37]||(t[37]=(0,a.Lk)("div",{class:"modal-title"},"Edit Member Profile",-1)),t[38]||(t[38]=(0,a.Lk)("div",{class:"modal-desc",style:{"font-size":"1.5rem !important"}}," Update member information. ",-1)),(0,a.Lk)("form",{class:"modal-form",onSubmit:t[13]||(t[13]=(0,s.D$)((...e)=>U.onEditSave&&U.onEditSave(...e),["prevent"]))},[(0,a.bF)(J,{style:{"margin-bottom":"0 !important"}},{default:(0,a.k6)(()=>[(0,a.bF)(G,{style:{"font-size":"1rem !important",margin:"0 !important"}},{default:(0,a.k6)(()=>[...t[31]||(t[31]=[(0,a.eW)("First Name",-1)])]),_:1}),(0,a.bF)(H,{modelValue:Q.editMember.first_name,"onUpdate:modelValue":t[8]||(t[8]=e=>Q.editMember.first_name=e),icon:"fas fa-user",type:"text",placeholder:"Enter first name",required:""},null,8,["modelValue"]),Q.errors.first_name?((0,a.uX)(),(0,a.Wv)(G,{key:0,class:"error-message1"},{default:(0,a.k6)(()=>[(0,a.eW)((0,o.v_)(Q.errors.first_name[0]),1)]),_:1})):(0,a.Q3)("",!0)]),_:1}),(0,a.bF)(J,{style:{"margin-bottom":"0 !important"}},{default:(0,a.k6)(()=>[(0,a.bF)(G,{style:{"font-size":"1rem !important",margin:"0 !important"}},{default:(0,a.k6)(()=>[...t[32]||(t[32]=[(0,a.eW)("Last Name",-1)])]),_:1}),(0,a.bF)(H,{modelValue:Q.editMember.last_name,"onUpdate:modelValue":t[9]||(t[9]=e=>Q.editMember.last_name=e),icon:"fas fa-user",type:"text",placeholder:"Enter last name",required:""},null,8,["modelValue"]),Q.errors.last_name?((0,a.uX)(),(0,a.Wv)(G,{key:0,class:"error-message1"},{default:(0,a.k6)(()=>[(0,a.eW)((0,o.v_)(Q.errors.last_name[0]),1)]),_:1})):(0,a.Q3)("",!0)]),_:1}),(0,a.bF)(J,{style:{"margin-bottom":"0 !important"}},{default:(0,a.k6)(()=>[(0,a.bF)(G,{style:{"font-size":"1rem !important",margin:"0 !important"}},{default:(0,a.k6)(()=>[...t[33]||(t[33]=[(0,a.eW)("Email",-1)])]),_:1}),(0,a.bF)(H,{modelValue:Q.editMember.email,"onUpdate:modelValue":t[10]||(t[10]=e=>Q.editMember.email=e),icon:"fas fa-envelope",type:"email",placeholder:"Enter email address",required:""},null,8,["modelValue"]),Q.errors.email?((0,a.uX)(),(0,a.Wv)(G,{key:0,class:"error-message1"},{default:(0,a.k6)(()=>[(0,a.eW)((0,o.v_)(Q.errors.email[0]),1)]),_:1})):(0,a.Q3)("",!0)]),_:1}),(0,a.bF)(J,{style:{"margin-bottom":"0 !important"}},{default:(0,a.k6)(()=>[(0,a.bF)(G,{style:{"font-size":"1rem !important",margin:"0 !important"}},{default:(0,a.k6)(()=>[...t[34]||(t[34]=[(0,a.eW)("Phone",-1)])]),_:1}),(0,a.bF)(H,{modelValue:Q.editMember.phone,"onUpdate:modelValue":t[11]||(t[11]=e=>Q.editMember.phone=e),icon:"fas fa-phone",type:"text",placeholder:"Enter phone number"},null,8,["modelValue"]),Q.errors.phone?((0,a.uX)(),(0,a.Wv)(G,{key:0,class:"error-message1"},{default:(0,a.k6)(()=>[(0,a.eW)((0,o.v_)(Q.errors.phone[0]),1)]),_:1})):(0,a.Q3)("",!0)]),_:1}),(0,a.bF)(J,{style:{"margin-bottom":"0 !important"}},{default:(0,a.k6)(()=>[(0,a.bF)(G,{style:{"font-size":"1rem !important",margin:"0 !important"}},{default:(0,a.k6)(()=>[...t[35]||(t[35]=[(0,a.eW)("Role",-1)])]),_:1}),(0,a.bF)(O,{options:Q.rolesForSelect,selectedItems:Array.isArray(Q.editMember.member_role_ids)?Q.editMember.member_role_ids:[],"onUpdate:selectedItems":U.onEditRolesUpdate,placeholder:"Select role",enableSelectAll:!0},null,8,["options","selectedItems","onUpdate:selectedItems"]),Q.errors.member_role?((0,a.uX)(),(0,a.Wv)(G,{key:0,class:"error-message1"},{default:(0,a.k6)(()=>[(0,a.eW)((0,o.v_)(Q.errors.member_role[0]),1)]),_:1})):(0,a.Q3)("",!0)]),_:1}),(0,a.Lk)("div",V,[t[36]||(t[36]=(0,a.Lk)("button",{type:"submit",class:"btn btn-primary"},[(0,a.Lk)("i",{class:"fas fa-save"}),(0,a.eW)(" Save ")],-1)),(0,a.Lk)("button",{type:"button",class:"org-edit-cancel",onClick:t[12]||(t[12]=e=>Q.showEditModal=!1)}," Cancel ")])],32)])])):(0,a.Q3)("",!0)])])]),_:1})],64)}var Q=r(4631),U=r(733),B=r(5629),q=r(4335),K=r(3193),j=r(7420),G=r(2124),H=r(5298),J=r(4117),O=r(3413),Y=r(5094);const Z={name:"MemberListing",components:{MainLayout:Q.A,Pagination:U.A,TableHeader:B.A,FormRow:j.A,FormLabel:G.A,FormInput:H.A,MultiSelectDropdown:J.A,Toast:O.A},setup(){const e=(0,Y.S)();return{confirm:e}},data(){return{currentPage:1,pageSize:10,searchQuery:"",showPageDropdown:!1,sortKey:"",sortAsc:!0,members:[],filteredMembers:[],loading:!0,showMemberModal:!1,showEditModal:!1,selectedMemberEdit:{},editMember:{},rolesForSelect:[],rolesForSelectMap:{},groupsForSelect:[],groupsForSelectMap:{},errors:{}}},computed:{totalPages(){return Math.ceil(this.filteredMembers.length/this.pageSize)||1},paginatedMembers(){const e=[...this.filteredMembers];this.sortKey&&e.sort((e,t)=>{const r=e[this.sortKey]||"",a=t[this.sortKey]||"";return r<a?this.sortAsc?-1:1:r>a?this.sortAsc?1:-1:0});const t=(this.currentPage-1)*this.pageSize;return e.slice(t,t+this.pageSize)},paginationPages(){const e=this.totalPages;if(e<=7)return Array.from({length:e},(e,t)=>t+1);const t=[1];this.currentPage>4&&t.push("...");const r=Math.max(2,this.currentPage-1),a=Math.min(e-1,this.currentPage+1);for(let s=r;s<=a;s++)t.push(s);return this.currentPage<e-3&&t.push("..."),t.push(e),t}},methods:{normalizeMember(e){if(!e)return{};const t={...e};return t.memberRoles=Array.isArray(t.memberRoles)?t.memberRoles:[],t.memberRoles.length>0?t.member_role_ids=t.memberRoles.map(e=>({id:e.id,name:e.name})):t.member_role_ids=[],t},async openMemberModal(e){let t=null;"string"!==typeof e&&"number"!==typeof e||(t=e),!t&&e&&e.id&&(t=e.id),t?await this.fetchMemberById(t):this.selectedMemberEdit=this.normalizeMember(e),this.selectedMemberEdit?.id&&this.$router.push({path:this.$route.path,query:{...this.$route.query,member_id:this.selectedMemberEdit.id}}),this.showMemberModal=!0},async fetchMemberById(e){try{const t=K["default"].get("authToken"),r="http://127.0.0.1:8000",a=await q.A.get(`${r}/api/members/${e}`,{headers:{Authorization:`Bearer ${t}`}}),s=a.data.data;this.selectedMemberEdit=this.normalizeMember(s)}catch(t){console.error("Failed to fetch member details:",t),this.$toast.add({severity:"error",summary:"Error",detail:"Could not load member details.",life:3e3});const r=this.members.find(t=>t.id===parseInt(e));r&&(this.selectedMemberEdit=this.normalizeMember(r))}},formatMemberRoles(e){return e&&Array.isArray(e.memberRoles)&&e.memberRoles.length>0?e.memberRoles.map(e=>e.name).join(", "):e.member_role||"No Role"},formatMemberGroups(e){if(e&&Array.isArray(e.groups)&&e.groups.length>0)return e.groups.map(e=>e.name).join(", ");if(e&&Array.isArray(e.group_ids)&&e.group_ids.length>0){const t=e.group_ids.map(e=>{const t=this.groupsForSelectMap[e];return t?t.name:`Group ${e}`}).filter(e=>e);return t.length>0?t.join(", "):"No groups assigned"}return"No groups assigned"},formatDate(e){if(!e)return"Not available";try{const t=new Date(e);return isNaN(t.getTime())?"Invalid date":t.toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})}catch(t){return console.warn("Error formatting date:",t),"Invalid date"}},async openEditModal(){const e=this.selectedMemberEdit?.id;if(e)try{const t=K["default"].get("authToken"),r="http://127.0.0.1:8000",a=await q.A.get(`${r}/api/members/${e}`,{headers:{Authorization:`Bearer ${t}`}}),s=a.data.data;this.editMember=this.normalizeMember(s),this.errors={},this.showEditModal=!0}catch(t){console.error("Failed to fetch member details for editing:",t),this.$toast.add({severity:"error",summary:"Error",detail:"Could not load member details.",life:3e3}),this.editMember={...this.selectedMemberEdit},this.errors={},this.showEditModal=!0}else this.$toast.add({severity:"warn",summary:"Warning",detail:"No member selected.",life:3e3})},closeMemberModal(){this.showMemberModal=!1;const e={...this.$route.query};delete e.member_id,this.$router.push({path:this.$route.path,query:e})},async onEditSave(){try{const e=K["default"].get("authToken"),t="http://127.0.0.1:8000",r={};void 0!==this.editMember.first_name&&(r.first_name=this.editMember.first_name),void 0!==this.editMember.last_name&&(r.last_name=this.editMember.last_name),void 0!==this.editMember.email&&(r.email=this.editMember.email),void 0!==this.editMember.phone&&(r.phone=this.editMember.phone),this.editMember.member_role_ids&&this.editMember.member_role_ids.length>0&&(r.member_role=this.editMember.member_role_ids.map(e=>"object"===typeof e?parseInt(e.id):parseInt(e))),console.log("Sending payload:",r),console.log("Member roles array:",r.member_role);const a=await q.A.put(`${t}/api/members/${this.editMember.id}`,r,{headers:{Authorization:`Bearer ${e}`}}),s=this.normalizeMember(a.data.data||a.data),o=this.members.findIndex(e=>e.id===s.id);-1!==o&&this.members.splice(o,1,s),this.selectedMemberEdit={...s},this.onSearch(),this.errors={},this.showEditModal=!1,this.$toast.add({severity:"success",summary:"Success",detail:"Member updated successfully.",life:3e3})}catch(e){if(console.error("Failed to update member:",e),e.response&&422===e.response.status&&e.response.data&&e.response.data.errors)return this.errors=e.response.data.errors,void this.$toast.add({severity:"error",summary:"Validation Error",detail:"Please fix the errors below and try again.",life:3e3});const t=e.response?.data?.message||"An unexpected error occurred.";this.$toast.add({severity:"error",summary:"Update Failed",detail:t,sticky:!0}),this.showEditModal=!1}},getRoleForSelect(e){return this.rolesForSelectMap[e]||{id:e,name:`Role ${e}`}},onEditRolesUpdate(e){this.editMember.member_role_ids=e},async deleteMember(e){const t=`${e.first_name} ${e.last_name}`.trim()||e.email;this.confirm.require({message:`Are you sure you want to delete ${t}?`,header:"Confirm Delete",icon:"pi pi-trash",accept:async()=>{try{const t=K["default"].get("authToken"),r="http://127.0.0.1:8000";await q.A.delete(`${r}/api/members/${e.id}`,{headers:{Authorization:`Bearer ${t}`}}),this.members=this.members.filter(t=>t.id!==e.id),this.onSearch(),this.showMemberModal=!1,this.$toast.add({severity:"info",summary:"Deleted",detail:"Member has been deleted.",life:3e3})}catch(t){console.error("Failed to delete member",t),this.$toast.add({severity:"error",summary:"Delete Failed",detail:"Failed to delete member.",sticky:!0})}}})},onSearch(){const e=this.searchQuery.trim().toLowerCase();this.filteredMembers=e?this.members.filter(t=>Object.values(t).some(t=>String(t).toLowerCase().includes(e))):[...this.members],this.currentPage=1},goToPage(e){"number"===typeof e&&e>=1&&e<=this.totalPages&&(this.currentPage=e)},selectPageSize(e){this.pageSize=e,this.currentPage=1,this.showPageDropdown=!1},sortBy(e){this.sortKey===e?this.sortAsc=!this.sortAsc:(this.sortKey=e,this.sortAsc=!0)},async fetchInitialData(){this.loading=!0;try{const e=K["default"].get("authToken"),t="http://127.0.0.1:8000",[r,a,s]=await Promise.all([q.A.get(`${t}/api/members`,{headers:{Authorization:`Bearer ${e}`}}),q.A.get(`${t}/api/member-roles`,{headers:{Authorization:`Bearer ${e}`}}),q.A.get(`${t}/api/groups`,{headers:{Authorization:`Bearer ${e}`}})]);Array.isArray(a.data)&&a.data.length&&(this.rolesForSelect=a.data.map(e=>({id:e.id,name:e.name})),this.rolesForSelectMap=this.rolesForSelect.reduce((e,t)=>(e[t.id]=t,e),{}));const o=s.data?.data||s.data||[];Array.isArray(o)&&o.length&&(this.groupsForSelect=o.map(e=>({id:e.id,name:e.name})),this.groupsForSelectMap=this.groupsForSelect.reduce((e,t)=>(e[t.id]=t,e),{}));const i=r.data?.data||[];this.members=i.map(e=>this.normalizeMember(e)),this.filteredMembers=[...this.members]}catch(e){console.error("Failed to fetch initial data:",e),this.$toast.add({severity:"error",summary:"Failed to load data",detail:"Could not fetch members and roles from the server.",life:5e3})}finally{this.loading=!1}}},async mounted(){await this.fetchInitialData();const e=this.$route.query.member_id;if(e){const t=this.members.find(t=>t.id===parseInt(e));t?await this.openMemberModal(t):(console.warn(`Member with ID ${e} not found in the initial list. Attempting to fetch...`),await this.openMemberModal(e))}}};var ee=r(6262);const te=(0,ee.A)(Z,[["render",T]]),re=te},9586:(e,t,r)=>{e.exports=r.p+"img/Notes.d9b82ed3.svg"}}]);
//# sourceMappingURL=596.73ad6512.js.map