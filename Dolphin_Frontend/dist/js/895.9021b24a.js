"use strict";(self["webpackChunkdolphin"]=self["webpackChunkdolphin"]||[]).push([[895],{733:(e,t,s)=>{s.d(t,{A:()=>w});var a=s(641),r=s(33),i=s(8634);const o=s.p+"img/VectorLeft.078c6ba0.svg",n=s.p+"img/VectorRight.c1a1a195.svg",l={class:"footer-box"},d={class:"footer-controls split-footer-controls"},u={class:"notifications-page-size-dropdown"},c={key:0,class:"notifications-page-size-menu",ref:"pageSizeMenu"},m=["onClick"],p={class:"notifications-pagination"},g=["disabled"],h=["onClick"],f=["disabled"];function y(e,t,s,y,k,b){return(0,a.uX)(),(0,a.CE)("footer",l,[(0,a.Lk)("div",d,[(0,a.Lk)("div",u,[(0,a.Lk)("button",{class:"notifications-page-size-btn",onClick:t[0]||(t[0]=t=>e.$emit("togglePageDropdown")),ref:"pageSizeBtn"},[(0,a.eW)((0,r.v_)(s.pageSize)+"/page ",1),t[3]||(t[3]=(0,a.Lk)("img",{src:i,class:"notifications-page-size-arrow",alt:"Dropdown"},null,-1))],512),s.showPageDropdown?((0,a.uX)(),(0,a.CE)("div",c,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(s.pageSizes,t=>((0,a.uX)(),(0,a.CE)("div",{key:t,class:(0,r.C4)(["notifications-page-size-option",{selected:s.pageSize===t}]),onClick:s=>e.$emit("selectPageSize",t)},(0,r.v_)(t)+"/page ",11,m))),128))],512)):(0,a.Q3)("",!0)]),(0,a.Lk)("div",p,[(0,a.Lk)("button",{class:"notifications-pagination-btn prev",disabled:1===s.currentPage,onClick:t[1]||(t[1]=t=>e.$emit("goToPage",s.currentPage-1))},[...t[4]||(t[4]=[(0,a.Lk)("img",{src:o,alt:"Previous",class:"pagination-btn-icon"},null,-1),(0,a.Lk)("span",{class:"pagination-btn-text prev-text"},"Previous",-1)])],8,g),((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(b.computedPaginationPages,t=>((0,a.uX)(),(0,a.CE)(a.FK,null,["..."!==t?((0,a.uX)(),(0,a.CE)("button",{key:t+"-page",class:(0,r.C4)(["notifications-pagination-page",{selected:t===s.currentPage}]),onClick:s=>e.$emit("goToPage",t)},(0,r.v_)(t),11,h)):((0,a.uX)(),(0,a.CE)("span",{key:"ellipsis-"+Math.random(),class:"notifications-pagination-page"},"..."))],64))),256)),(0,a.Lk)("button",{class:"notifications-pagination-btn next",disabled:s.currentPage===s.totalPages,onClick:t[2]||(t[2]=t=>e.$emit("goToPage",s.currentPage+1))},[...t[5]||(t[5]=[(0,a.Lk)("span",{class:"pagination-btn-text next-text"},"Next",-1),(0,a.Lk)("img",{src:n,alt:"Next",class:"pagination-btn-icon"},null,-1)])],8,f)])])])}const k={name:"Pagination",props:{withPagination:{type:Boolean,default:!1},pageSize:Number,pageSizes:Array,showPageDropdown:Boolean,currentPage:Number,totalPages:{type:Number,default:10},paginationPages:Array},computed:{computedPaginationPages(){const e=this.totalPages||10,t=this.currentPage||1;return e<=7?Array.from({length:e},(e,t)=>t+1):t<=3?[1,2,3,4,"...",e-1,e]:4===t?[1,3,4,5,"...",e-1,e]:5===t?[1,4,5,6,"...",e-1,e]:6===t?[1,5,6,7,"...",e-1,e]:7===t?[1,2,"...",6,7,8,e,e-1].filter((e,t,s)=>s.indexOf(e)===t):t===e-2?[1,2,"...",e-3,e-2,e-1,e]:t===e-1||t===e?[1,2,"...",e-2,e-1,e]:[1,2,"...",t-1,t,t+1,"...",e-1,e].filter((e,t,s)=>s.indexOf(e)===t)}},mounted(){document.addEventListener("mousedown",this.handleClickOutside)},beforeUnmount(){document.removeEventListener("mousedown",this.handleClickOutside)},methods:{handleClickOutside(e){if(!this.showPageDropdown)return;const t=this.$refs.pageSizeMenu,s=this.$refs.pageSizeBtn;t&&!t.contains(e.target)&&s&&!s.contains(e.target)&&this.$emit("togglePageDropdown")}}};var b=s(6262);const v=(0,b.A)(k,[["render",y],["__scopeId","data-v-63376d46"]]),w=v},1728:(e,t,s)=>{e.exports=s.p+"img/Add.1f261cbb.svg"},5629:(e,t,s)=>{s.d(t,{A:()=>m});var a=s(641),r=s(33),i=s(3751);const o=s.p+"img/up-down.53d62c9d.svg",n=["role","tabindex","onClick","onKeyup"];function l(e,t,s,l,d,u){return(0,a.uX)(),(0,a.CE)(a.FK,null,[(0,a.Lk)("colgroup",null,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(s.columns,(e,t)=>((0,a.uX)(),(0,a.CE)("col",{key:"col-"+(e.key||t),class:(0,r.C4)(e.width||e.minWidth),style:(0,r.Tr)(u.getColumnStyle(e))},null,6))),128))]),(0,a.Lk)("thead",null,[(0,a.Lk)("tr",null,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(s.columns,(t,l)=>((0,a.uX)(),(0,a.CE)("th",{key:t.key||l,class:(0,r.C4)([0===l?"rounded-th-left":"",l===s.columns.length-1?"rounded-th-right":"",t.width||t.minWidth,t.class||""]),style:(0,r.Tr)(u.getColumnStyle(t)),role:t.sortable?"button":null,tabindex:t.sortable?0:null,scope:"col",onClick:s=>!0===t.sortable?e.$emit("sort",t.key):null,onKeyup:(0,i.jR)(s=>!0===t.sortable?e.$emit("sort",t.key):null,["enter"])},[(0,a.Lk)("span",{class:(0,r.C4)(["org-th-content",t.sortable?"org-th-sortable":"",s.activeSortKey===t.key?"sorted":""])},[(0,a.eW)((0,r.v_)(t.label)+" ",1),!0===t.sortable?((0,a.uX)(),(0,a.CE)("img",{key:0,src:o,class:(0,r.C4)(["org-th-sort",s.activeSortKey===t.key?s.sortAsc?"asc":"desc":""]),alt:"Sort"},null,2)):(0,a.Q3)("",!0)],2)],46,n))),128))])])],64)}const d={name:"TableHeader",emits:["sort"],props:{columns:{type:Array,required:!0},activeSortKey:{type:String,default:null},sortAsc:{type:Boolean,default:!0}},methods:{getColumnStyle(e){let t={};if(e.width&&(t.width="number"===typeof e.width?e.width+"px":e.width),e.minWidth&&(t.minWidth="number"===typeof e.minWidth?e.minWidth+"px":e.minWidth),e.style){const s=e.style.split(";").filter(e=>e.trim());s.forEach(e=>{const[s,a]=e.split(":").map(e=>e.trim());if(s&&a){const e=s.replace(/-([a-z])/g,e=>e[1].toUpperCase());t[e]=a}})}return Object.keys(t).length>0?t:null}}};var u=s(6262);const c=(0,u.A)(d,[["render",l],["__scopeId","data-v-9953bdcc"]]),m=c},9750:(e,t,s)=>{s.r(t),s.d(t,{default:()=>R});var a=s(641),r=s(33),i=s(3751),o=s(1728);const n=s.p+"img/EditBlack.2389c1e6.svg",l=s.p+"img/Delete icon.530f9b63.svg",d=s.p+"img/Impersonate.7801c485.svg",u={class:"page"},c={class:"table-outer"},m={class:"table-card"},p={class:"table-header-bar"},g={class:"table-container"},h={class:"table"},f={key:0},y={key:1},k={class:"actions-row"},b=["onClick"],v=["onClick"],w=["onClick"],_={key:1,class:"btn-view",disabled:""},E={class:"modal-card",style:{"max-width":"550px"}},C={class:"modal-form-actions"},P=["disabled"];function L(e,t,s,L,S,A){const U=(0,a.g2)("Toast"),F=(0,a.g2)("TableHeader"),z=(0,a.g2)("Pagination"),$=(0,a.g2)("MainLayout"),I=(0,a.g2)("FormLabel"),x=(0,a.g2)("FormInput"),D=(0,a.g2)("FormRow"),T=(0,a.g2)("FormDropdown");return(0,a.uX)(),(0,a.CE)(a.FK,null,[(0,a.bF)(U),(0,a.bF)($,null,{default:(0,a.k6)(()=>[(0,a.Lk)("div",u,[(0,a.Lk)("div",c,[(0,a.Lk)("div",m,[(0,a.Lk)("div",p,[(0,a.Lk)("button",{class:"btn btn-primary",onClick:t[0]||(t[0]=t=>e.$router.push("/user-permission/add"))},[...t[10]||(t[10]=[(0,a.Lk)("img",{src:o,alt:"Add",class:"user-permission-add-btn-icon"},null,-1),(0,a.eW)(" Add New ",-1)])])]),(0,a.Lk)("div",g,[(0,a.Lk)("table",h,[(0,a.bF)(F,{columns:[{label:"Name",key:"name",minWidth:"180px"},{label:"Email",key:"email",minWidth:"260px"},{label:"Roles",key:"role",minWidth:"180px"},{label:"Actions",key:"actions",minWidth:"260px"}],onSort:A.sortBy},null,8,["onSort"]),(0,a.Lk)("tbody",null,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(A.paginatedUsers,e=>((0,a.uX)(),(0,a.CE)("tr",{key:e.id},[(0,a.Lk)("td",null,[e.first_name||e.last_name?((0,a.uX)(),(0,a.CE)("span",f,(0,r.v_)(e.first_name||"")+(0,r.v_)(e.last_name?" "+e.last_name:""),1)):((0,a.uX)(),(0,a.CE)("span",y,(0,r.v_)(e.name),1))]),(0,a.Lk)("td",null,(0,r.v_)(e.email),1),(0,a.Lk)("td",null,(0,r.v_)(A.formatRoleLabel(e.role)),1),(0,a.Lk)("td",null,[(0,a.Lk)("div",k,[(0,a.Lk)("button",{class:"icon-btn",title:"Edit",onClick:t=>A.openEditModal(e)},[...t[11]||(t[11]=[(0,a.Lk)("img",{src:n,alt:"Edit"},null,-1)])],8,b),(0,a.Lk)("button",{class:"icon-btn",title:"Delete",onClick:t=>A.deleteUser(e)},[...t[12]||(t[12]=[(0,a.Lk)("img",{src:l,alt:"Delete"},null,-1)])],8,v),A.canImpersonate(e)?((0,a.uX)(),(0,a.CE)("button",{key:0,class:"btn-view impersonate-btn",onClick:t=>A.impersonateUser(e)},[...t[13]||(t[13]=[(0,a.Lk)("img",{src:d,alt:"Impersonate",class:"btn-view-icon impersonate-icon"},null,-1),(0,a.eW)(" Impersonate ",-1)])],8,w)):((0,a.uX)(),(0,a.CE)("button",_,[...t[14]||(t[14]=[(0,a.Lk)("img",{src:d,alt:"Impersonate",class:"btn-view-icon"},null,-1),(0,a.eW)(" Impersonate ",-1)])]))])])]))),128))])])])]),(0,a.bF)(z,{pageSize:S.pageSize,pageSizes:S.pageSizes,showPageDropdown:S.showPageDropdown,currentPage:S.currentPage,totalPages:A.totalPages,onTogglePageDropdown:t[1]||(t[1]=e=>S.showPageDropdown=!S.showPageDropdown),onSelectPageSize:A.selectPageSize,onGoToPage:A.goToPage},null,8,["pageSize","pageSizes","showPageDropdown","currentPage","totalPages","onSelectPageSize","onGoToPage"])])])]),_:1}),S.showEditModal?((0,a.uX)(),(0,a.CE)("div",{key:0,class:"modal-overlay",onClick:t[9]||(t[9]=(0,i.D$)(e=>S.showEditModal=!1,["self"]))},[(0,a.Lk)("div",E,[(0,a.Lk)("button",{class:"modal-close-btn",onClick:t[2]||(t[2]=e=>S.showEditModal=!1)}," Ã— "),t[20]||(t[20]=(0,a.Lk)("div",{class:"modal-title"},"Edit User",-1)),t[21]||(t[21]=(0,a.Lk)("div",{class:"modal-desc",style:{"font-size":"1.5rem !important"}}," Update user information. ",-1)),(0,a.Lk)("form",{class:"modal-form",onSubmit:t[8]||(t[8]=(0,i.D$)((...e)=>A.saveEditUser&&A.saveEditUser(...e),["prevent"]))},[(0,a.bF)(D,{style:{"margin-bottom":"0 !important"}},{default:(0,a.k6)(()=>[(0,a.bF)(I,{style:{"font-size":"1rem !important",margin:"0 !important"}},{default:(0,a.k6)(()=>[...t[15]||(t[15]=[(0,a.eW)("First Name",-1)])]),_:1}),(0,a.bF)(x,{modelValue:S.editUser.first_name,"onUpdate:modelValue":t[3]||(t[3]=e=>S.editUser.first_name=e),icon:"fas fa-user",type:"text",placeholder:"Enter first name",required:""},null,8,["modelValue"])]),_:1}),(0,a.bF)(D,{style:{"margin-bottom":"0 !important"}},{default:(0,a.k6)(()=>[(0,a.bF)(I,{style:{"font-size":"1rem !important",margin:"0 !important"}},{default:(0,a.k6)(()=>[...t[16]||(t[16]=[(0,a.eW)("Last Name",-1)])]),_:1}),(0,a.bF)(x,{modelValue:S.editUser.last_name,"onUpdate:modelValue":t[4]||(t[4]=e=>S.editUser.last_name=e),icon:"fas fa-user",type:"text",placeholder:"Enter last name",required:""},null,8,["modelValue"])]),_:1}),(0,a.bF)(D,{style:{"margin-bottom":"0 !important"}},{default:(0,a.k6)(()=>[(0,a.bF)(I,{style:{"font-size":"1rem !important",margin:"0 !important"}},{default:(0,a.k6)(()=>[...t[17]||(t[17]=[(0,a.eW)("Email",-1)])]),_:1}),(0,a.bF)(x,{modelValue:S.editUser.email,"onUpdate:modelValue":t[5]||(t[5]=e=>S.editUser.email=e),icon:"fas fa-envelope",type:"email",placeholder:"Enter email address",required:""},null,8,["modelValue"])]),_:1}),(0,a.bF)(D,{style:{"margin-bottom":"0 !important"}},{default:(0,a.k6)(()=>[(0,a.bF)(I,{style:{"font-size":"1rem !important",margin:"0 !important"}},{default:(0,a.k6)(()=>[...t[18]||(t[18]=[(0,a.eW)("Role",-1)])]),_:1}),(0,a.bF)(T,{modelValue:S.editUser.role,"onUpdate:modelValue":t[6]||(t[6]=e=>S.editUser.role=e),icon:"fas fa-user-tag",options:S.roleOptions,placeholder:"Select role"},null,8,["modelValue","options"])]),_:1}),(0,a.Lk)("div",C,[(0,a.Lk)("button",{type:"submit",class:"btn btn-primary",disabled:S.isSaving},[t[19]||(t[19]=(0,a.Lk)("i",{class:"fas fa-save"},null,-1)),(0,a.eW)(" "+(0,r.v_)(S.isSaving?" Saving...":" Save"),1)],8,P),(0,a.Lk)("button",{type:"button",class:"org-edit-cancel",onClick:t[7]||(t[7]=e=>S.showEditModal=!1)}," Cancel ")])],32)])])):(0,a.Q3)("",!0)],64)}var S=s(4631),A=s(733),U=s(5629),F=s(7420),z=s(2124),$=s(5298),I=s(7035),x=s(3413),D=s(3709),T=s(3080),N=s(5094),W=s(932);const X={name:"UserPermission",components:{MainLayout:S.A,Pagination:A.A,TableHeader:U.A,FormRow:F.A,FormLabel:z.A,FormInput:$.A,FormDropdown:I.A,ConfirmDialog:D.A,Toast:x.A},data(){return{users:[],loading:!1,isSaving:!1,currentPage:1,pageSize:10,pageSizes:[10,25,100],showPageDropdown:!1,sortKey:"",sortAsc:!0,showEditModal:!1,editUser:{id:null,first_name:"",last_name:"",email:"",role:"",successMessage:"",errorMessage:"",errors:{}},roleOptions:[{value:"organizationadmin",text:"Organization Admin"},{value:"dolphinadmin",text:"Dolphin Admin"},{value:"salesperson",text:"Sales Person"},{value:"user",text:"User"}]}},setup(){const e=(0,T.d)(),t=(0,N.S)();return{toast:e,confirm:t}},created(){this.fetchUsers()},computed:{totalPages(){return Math.ceil(this.users.filter(e=>"superadmin"!==e.role).length/this.pageSize)||1},paginatedUsers(){let e=this.users.filter(e=>"superadmin"!==e.role);this.sortKey&&e.sort((e,t)=>{const s=e[this.sortKey]||"",a=t[this.sortKey]||"";return s<a?this.sortAsc?-1:1:s>a?this.sortAsc?1:-1:0});const t=(this.currentPage-1)*this.pageSize;return e.slice(t,t+this.pageSize)},isSuperAdmin(){const e=s(3193)["default"];return"superadmin"===e.get("role")},isImpersonating(){const e=s(3193)["default"];return!!e.get("superAuthToken")}},methods:{formatRole(e){return(0,W.W)(e)},formatRoleLabel(e){return(0,W.W)(e)},getAuthHeaders(){const e=s(3193)["default"],t=e.get("authToken");return t?{Authorization:`Bearer ${t}`}:{}},canImpersonate(e){const t=s(3193)["default"],a=parseInt(t.get("userId")||"0");return this.isSuperAdmin&&"superadmin"!==e.role&&e.id!==a},async impersonateUser(e){const t=e.first_name||e.last_name?`${e.first_name||""}${e.last_name?" "+e.last_name:""}`.trim():e.name||e.email||"this user";this.confirm.require({message:`Are you sure you want to impersonate ${t}?`,header:"Confirm Impersonation",icon:"pi pi-user",acceptLabel:"Yes",rejectLabel:"No",accept:async()=>{try{const a="http://127.0.0.1:8000",r=await fetch(`${a}/api/users/${e.id}/impersonate`,{method:"POST",headers:this.getAuthHeaders()});if(!r.ok){const e=await r.json().catch(()=>({}));throw new Error(e.message||"Failed to impersonate user")}const i=await r.json(),o=s(3193)["default"];o.set("superAuthToken",o.get("authToken")),o.set("superRole",o.get("role")),o.set("superUserId",o.get("userId")),o.set("superFirstName",o.get("first_name")||""),o.set("superLastName",o.get("last_name")||""),o.set("superUserName",o.get("userName")||""),o.set("superEmail",o.get("email")||""),o.set("authToken",i.impersonated_token),o.set("role",i.user.role),o.set("userId",i.user.id),o.set("first_name",i.user.first_name||""),o.set("last_name",i.user.last_name||""),o.set("email",i.user.email||""),i.user.first_name||i.user.last_name?o.set("userName",`${i.user.first_name||""}${i.user.last_name?" "+i.user.last_name:""}`.trim()):o.set("userName",i.user.name||i.user.email||"");try{window.dispatchEvent(new Event("auth-updated"))}catch(t){console.error("Error dispatching auth-updated event",t)}this.$router.go(0)}catch(t){this.toast.add({severity:"error",summary:"Error",detail:t.message||"Error impersonating user",life:4e3})}},reject:()=>{}})},revertImpersonation(){if(!this.isImpersonating)return;const e=s(3193)["default"];e.set("authToken",e.get("superAuthToken")),e.set("role",e.get("superRole")),e.set("userId",e.get("superUserId")),e.set("first_name",e.get("superFirstName")||""),e.set("last_name",e.get("superLastName")||""),e.set("userName",e.get("superUserName")||""),e.set("email",e.get("superEmail")||""),e.remove("superAuthToken"),e.remove("superRole"),e.remove("superUserId"),e.remove("superFirstName"),e.remove("superLastName"),e.remove("superUserName"),e.remove("superEmail"),this.$router.go(0);try{window.dispatchEvent(new Event("auth-updated"))}catch(t){}},async fetchUsers(){this.loading=!0;try{const e="http://127.0.0.1:8000",t=await fetch(`${e}/api/users`,{headers:this.getAuthHeaders()});if(!t.ok)throw new Error("Failed to fetch users");const s=await t.json();this.users=(s.users||s||[]).map(e=>({id:e.id,first_name:e.first_name||"",last_name:e.last_name||"",email:e.email||"",role:(e.role||"user").toString().toLowerCase(),name:e.first_name||e.last_name?`${e.first_name||""}${e.last_name?" "+e.last_name:""}`:e.name||e.full_name||""}))}catch(e){this.toast.add({severity:"error",summary:"Error",detail:e.message||"Error fetching users",life:4e3})}finally{this.loading=!1}},async deleteUser(e){if(this.isDeleting)return;const t=e.name||e.email||"this user";this.confirm.require({message:`Are you sure you want to delete ${t}?`,header:"Confirm Delete",icon:"pi pi-trash",acceptLabel:"Yes",rejectLabel:"No",accept:async()=>{this.isDeleting=!0;try{const t="http://127.0.0.1:8000",s=await fetch(`${t}/api/users/${e.id}/soft-delete`,{method:"PATCH",headers:this.getAuthHeaders()});if(!s.ok)throw new Error("Failed to delete user");this.users=this.users.filter(t=>t.id!==e.id),this.toast.add({severity:"success",summary:"Success",detail:"User deleted successfully!",life:3e3})}catch(t){this.toast.add({severity:"error",summary:"Error",detail:t.message||"Error deleting user",life:4e3})}finally{this.isDeleting=!1}},reject:()=>{}})},async changeRole(e,t){if(e.role!==t)try{const s="http://127.0.0.1:8000",a=await fetch(`${s}/api/users/${e.id}/role`,{method:"PUT",headers:{...this.getAuthHeaders(),"Content-Type":"application/json"},body:JSON.stringify({role:t})});if(!a.ok)throw new Error("Failed to change role");e.role=t,this.toast.add({severity:"success",summary:"Success",detail:"Role changed successfully!",life:3e3})}catch(s){this.toast.add({severity:"error",summary:"Error",detail:s.message||"Error changing role",life:4e3})}},goToPage(e){e<1||e>this.totalPages||(this.currentPage=e)},selectPageSize(e){this.pageSize=e,this.currentPage=1,this.showPageDropdown=!1},sortBy(e){this.sortKey===e?this.sortAsc=!this.sortAsc:(this.sortKey=e,this.sortAsc=!0)},openEditModal(e){this.editUser={...e},this.showEditModal=!0},async saveEditUser(e){if(e&&e.preventDefault&&e.preventDefault(),this.isSaving)return;this.isSaving=!0;const t=this.users.findIndex(e=>e.id===this.editUser.id);if(-1!==t)try{const e="http://127.0.0.1:8000",s=await fetch(`${e}/api/users/${this.editUser.id}/role`,{method:"PATCH",headers:{...this.getAuthHeaders(),"Content-Type":"application/json"},body:JSON.stringify({first_name:this.editUser.first_name,last_name:this.editUser.last_name,email:this.editUser.email,role:this.editUser.role})});if(!s.ok){const e=await s.json().catch(()=>({}));return this.toast.add({severity:"error",summary:"Error",detail:e.message||"Failed to update user",life:4e3}),void(this.isSaving=!1)}const a=await s.json();this.users[t]={...this.editUser,...a},this.showEditModal=!1,this.toast.add({severity:"success",summary:"Success",detail:"User updated successfully!",life:3e3})}catch(s){this.toast.add({severity:"error",summary:"Error",detail:s.message||"Failed to update user.",life:4e3})}finally{this.isSaving=!1}else this.isSaving=!1}}};var K=s(6262);const M=(0,K.A)(X,[["render",L],["__scopeId","data-v-73e2353c"]]),R=M}}]);
//# sourceMappingURL=895.9021b24a.js.map