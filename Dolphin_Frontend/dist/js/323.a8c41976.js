"use strict";(self["webpackChunkdolphin"]=self["webpackChunkdolphin"]||[]).push([[323],{6664:(e,t,a)=>{e.exports=a.p+"img/Detail.a366cc56.svg"},7213:(e,t,a)=>{a.r(t),a.d(t,{default:()=>pe});var i=a(641),n=a(33),o=a(3751);const s=a.p+"img/SendNotification.0bde51c1.svg";var l=a(6664);const r={class:"page"},d={class:"table-outer"},c={class:"table-card"},u={class:"table-header-bar"},h={class:"table-container"},m={class:"table"},p={class:"notification-body-cell"},g=["title"],f=["onClick"],v={key:0},_={class:"modal-card"},y={class:"modal-row"},k={class:"modal-field"},A={class:"modal-field"},b={class:"modal-row"},L={class:"modal-field"},w={class:"modal-row"},S={class:"schedule-demo-field schedule-demo-schedule-field"},D={class:"modal-row"},E={class:"modal-field"},P={class:"form-box"},z={class:"modal-field"},N={class:"form-box"};function $(e,t,a,$,T,x){const U=(0,i.g2)("Toast"),C=(0,i.g2)("TableHeader"),F=(0,i.g2)("Pagination"),M=(0,i.g2)("FormLabel"),I=(0,i.g2)("MultiSelectDropdown"),R=(0,i.g2)("FormInput"),B=(0,i.g2)("NotificationDetail"),O=(0,i.g2)("MainLayout");return(0,i.uX)(),(0,i.Wv)(O,null,{default:(0,i.k6)(()=>[(0,i.bF)(U),(0,i.Lk)("div",r,[(0,i.Lk)("div",d,[(0,i.Lk)("div",c,[(0,i.Lk)("div",u,[(0,i.Lk)("button",{class:"btn btn-primary",onClick:t[0]||(t[0]=e=>T.showSendModal=!0)},[...t[10]||(t[10]=[(0,i.Lk)("img",{src:s,alt:"Send",class:"notifications-add-btn-icon"},null,-1),(0,i.eW)(" Send Notification ",-1)])])]),(0,i.Lk)("div",h,[(0,i.Lk)("table",m,[(0,i.bF)(C,{columns:[{label:"Notification Title",key:"body",minWidth:"225px",sortable:!0},{label:"Scheduled Date & Time",key:"scheduled_at",minWidth:"225px",sortable:!0},{label:"Sent Date & Time",key:"sent_at",minWidth:"225px",sortable:!0},{label:"Action",key:"action",minWidth:"200px"}],activeSortKey:T.sortKey,sortAsc:T.sortAsc,onSort:x.sortBy},null,8,["activeSortKey","sortAsc","onSort"]),(0,i.Lk)("tbody",null,[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(x.paginatedNotifications,e=>((0,i.uX)(),(0,i.CE)("tr",{key:e.id},[(0,i.Lk)("td",p,[(0,i.Lk)("span",{class:"notification-body-truncate",title:e.body,style:{"max-width":"200px",transition:"max-width 0.18s ease, white-space 0.18s ease",overflow:"hidden","white-space":"nowrap","text-overflow":"ellipsis",display:"inline-block"}},(0,n.v_)(e.body),9,g)]),(0,i.Lk)("td",null,(0,n.v_)(x.formatLocalDateTime(e.scheduled_at)),1),(0,i.Lk)("td",null,(0,n.v_)(e.sent_at?x.formatLocalDateTime(e.sent_at):"-"),1),(0,i.Lk)("td",null,[(0,i.Lk)("button",{class:"btn-view",onClick:t=>x.openDetail(e)},[...t[11]||(t[11]=[(0,i.Lk)("img",{src:l,alt:"View",class:"btn-view-icon"},null,-1),(0,i.eW)(" View Detail ",-1)])],8,f)])]))),128)),0===x.paginatedNotifications.length?((0,i.uX)(),(0,i.CE)("tr",v,[...t[12]||(t[12]=[(0,i.Lk)("td",{colspan:"4",class:"no-data"}," No notifications found. ",-1)])])):(0,i.Q3)("",!0)])])])])])]),(0,i.bF)(F,{pageSize:T.pageSize,pageSizes:[10,25,100],showPageDropdown:T.showPageDropdown,currentPage:T.currentPage,totalPages:x.totalPages,paginationPages:x.paginationPages,onGoToPage:x.goToPage,onSelectPageSize:x.selectPageSize,onTogglePageDropdown:t[1]||(t[1]=e=>T.showPageDropdown=!T.showPageDropdown)},null,8,["pageSize","showPageDropdown","currentPage","totalPages","paginationPages","onGoToPage","onSelectPageSize"]),T.showSendModal?((0,i.uX)(),(0,i.CE)("div",{key:0,class:"modal-overlay",onClick:t[9]||(t[9]=(0,o.D$)(e=>T.showSendModal=!1,["self"]))},[(0,i.Lk)("div",_,[(0,i.Lk)("button",{class:"modal-close-btn",onClick:t[2]||(t[2]=e=>T.showSendModal=!1)}," × "),t[18]||(t[18]=(0,i.Lk)("div",{class:"modal-title"},"Send Notifications",-1)),t[19]||(t[19]=(0,i.Lk)("div",{class:"modal-desc"}," Send a notification to selected organizations, admins, or groups. You can also schedule it for later. ",-1)),t[20]||(t[20]=(0,i.Lk)("textarea",{class:"modal-textarea",placeholder:"Type your notification here..."},null,-1)),(0,i.Lk)("div",y,[(0,i.Lk)("div",k,[(0,i.bF)(M,null,{default:(0,i.k6)(()=>[...t[13]||(t[13]=[(0,i.eW)("Select Organizations",-1)])]),_:1}),(0,i.bF)(I,{options:T.organizations||[],selectedItems:T.selectedOrganizations,"onUpdate:selectedItems":t[3]||(t[3]=e=>T.selectedOrganizations=e),"option-label":"organization_name","option-value":"id",placeholder:"Select organizations",enableSelectAll:!0},null,8,["options","selectedItems"])]),(0,i.Lk)("div",A,[(0,i.bF)(M,null,{default:(0,i.k6)(()=>[...t[14]||(t[14]=[(0,i.eW)("Select Group",-1)])]),_:1}),(0,i.bF)(I,{options:T.groups||[],selectedItems:T.selectedGroups,"onUpdate:selectedItems":t[4]||(t[4]=e=>T.selectedGroups=e),placeholder:"Select groups",enableSelectAll:!0},null,8,["options","selectedItems"])])]),(0,i.Lk)("div",b,[(0,i.Lk)("div",L,[(0,i.bF)(M,null,{default:(0,i.k6)(()=>[...t[15]||(t[15]=[(0,i.eW)("Select Admin",-1)])]),_:1}),(0,i.bF)(I,{options:T.admins||[],selectedItems:T.selectedAdmins,"onUpdate:selectedItems":t[5]||(t[5]=e=>T.selectedAdmins=e),"option-label":"name","option-value":"id",placeholder:"Select admins",enableSelectAll:!0},null,8,["options","selectedItems"])]),t[16]||(t[16]=(0,i.Lk)("div",{class:"modal-field"},null,-1))]),(0,i.Lk)("div",w,[(0,i.Lk)("div",S,[(0,i.bF)(M,null,{default:(0,i.k6)(()=>[...t[17]||(t[17]=[(0,i.eW)("Schedule",-1)])]),_:1}),(0,i.Lk)("div",D,[(0,i.Lk)("div",E,[(0,i.Lk)("div",P,[(0,i.bF)(R,{modelValue:T.scheduledDate,"onUpdate:modelValue":t[6]||(t[6]=e=>T.scheduledDate=e),type:"date",placeholder:"MM/DD/YYYY"},null,8,["modelValue"])])]),(0,i.Lk)("div",z,[(0,i.Lk)("div",N,[(0,i.bF)(R,{modelValue:T.scheduledTime,"onUpdate:modelValue":t[7]||(t[7]=e=>T.scheduledTime=e),type:"time",placeholder:"00:00"},null,8,["modelValue"])])])])])]),(0,i.Lk)("button",{class:"btn btn-primary",onClick:t[8]||(t[8]=(...e)=>x.sendNotification&&x.sendNotification(...e))}," Send Notification ")])])):(0,i.Q3)("",!0),(0,i.bF)(B,{visible:T.showDetailModal,announcement:T.detailData&&T.detailData.announcement,groups:T.detailData&&T.detailData.groups,organizations:T.detailData&&T.detailData.organizations,notifications:T.detailData&&T.detailData.notifications,onClose:x.closeDetail},null,8,["visible","announcement","groups","organizations","notifications","onClose"])]),_:1})}var T=a(4631),x=a(4335),U=a(3193),C=a(733),F=a(5629);const M={class:"modal-card",style:{"max-width":"900px",width:"90%"}},I={class:"modal-title schedule-header",style:{"font-size":"20px","font-weight":"450"}},R={class:"schedule-header-left"},B={class:"schedule-assessment-name",style:{display:"inline-block","vertical-align":"middle","max-width":"520px","margin-right":"12px"}},O={class:"schedule-assessment-name",style:{display:"inline-block","vertical-align":"middle","margin-left":"12px"}},V={class:"schedule-header-right"},W={class:"NotificationDetailBodyForOrganizations"},G={key:0,class:"NotificationDetailBodyForOrganizations"},X={class:"detail-row"},K={class:"detail-table",style:{width:"100% !important","max-width":"800px !important",margin:"0 !important"}},Q={class:"recipient-table-wrap",style:{"overflow-x":"auto","-webkit-overflow-scrolling":"touch",width:"100%"}},Y={class:"recipient-table compact",style:{width:"100%","min-width":"500px"}},H={key:0},J={class:"NotificationDetailBodyForGroups"},q={key:0,class:"NotificationDetailBodyForGroups"},j={class:"detail-row"},Z={class:"detail-table",style:{width:"100% !important","max-width":"800px !important",margin:"0 !important"}},ee={class:"recipient-table-wrap",style:{"overflow-x":"auto","-webkit-overflow-scrolling":"touch",width:"100%"}},te={class:"recipient-table compact",style:{width:"100%","min-width":"500px"}},ae={key:0};function ie(e,t,a,s,l,r){const d=(0,i.g2)("TableHeader");return a.visible?((0,i.uX)(),(0,i.CE)("div",{key:0,class:"modal-overlay",onClick:t[1]||(t[1]=(0,o.D$)(t=>e.$emit("close"),["self"]))},[(0,i.Lk)("div",M,[(0,i.Lk)("button",{class:"modal-close-btn",onClick:t[0]||(t[0]=t=>e.$emit("close"))}," × "),t[8]||(t[8]=(0,i.Lk)("div",{class:"modal-title"},"Notification Detail",-1)),t[9]||(t[9]=(0,i.Lk)("div",{class:"modal-desc"}," Details for the selected notification / announcement. ",-1)),(0,i.Lk)("div",null,[t[7]||(t[7]=(0,i.Lk)("br",null,null,-1)),(0,i.Lk)("div",I,[(0,i.Lk)("div",R,[(0,i.Lk)("div",null,[(0,i.Lk)("div",B,(0,n.v_)(r.announcementBodyShort),1),t[2]||(t[2]=(0,i.eW)(" - ",-1)),(0,i.Lk)("div",O,(0,n.v_)(r.formatDateTime(r.announcementScheduledAt)),1)])]),(0,i.Lk)("div",V,["sent"===r.announcementStatus?((0,i.uX)(),(0,i.CE)("span",{key:0,class:(0,n.C4)(["status-green",{active:"sent"===r.announcementStatus}])},"Sent",2)):(0,i.Q3)("",!0),"scheduled"===r.announcementStatus?((0,i.uX)(),(0,i.CE)("span",{key:1,class:(0,n.C4)(["status-yellow",{active:"scheduled"===r.announcementStatus}])},"Scheduled",2)):(0,i.Q3)("",!0),"failed"===r.announcementStatus?((0,i.uX)(),(0,i.CE)("span",{key:2,class:(0,n.C4)(["status-red",{active:"failed"===r.announcementStatus}])},"Failed",2)):(0,i.Q3)("",!0)])]),(0,i.Lk)("div",W,[r.allRecipients.length?((0,i.uX)(),(0,i.CE)("div",G,[t[4]||(t[4]=(0,i.Lk)("div",{class:"modal-titleTABLE"}," Organization Notification Details ",-1)),(0,i.Lk)("div",X,[(0,i.Lk)("div",K,[(0,i.Lk)("div",Q,[(0,i.Lk)("table",Y,[(0,i.bF)(d,{columns:[{label:"Organization Name",key:"organization_name",minWidth:"200px"},{label:"User Name",key:"name",minWidth:"200px"},{label:"Emails",key:"email",minWidth:"200px"},{label:"Read At",key:"read_at",minWidth:"200px"}]}),(0,i.Lk)("tbody",null,[r.allRecipients.length?(0,i.Q3)("",!0):((0,i.uX)(),(0,i.CE)("tr",H,[...t[3]||(t[3]=[(0,i.Lk)("td",{colspan:"4",style:{"text-align":"center",padding:"20px"}}," No recipients found. ",-1)])])),((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(r.allRecipients,e=>((0,i.uX)(),(0,i.CE)("tr",{key:e.id},[(0,i.Lk)("td",null,(0,n.v_)(e.organization_name),1),(0,i.Lk)("td",null,(0,n.v_)(e.name),1),(0,i.Lk)("td",null,(0,n.v_)(e.email),1),(0,i.Lk)("td",null,[(0,i.Lk)("span",null,(0,n.v_)(e.read_at?r.formatDateTime(e.read_at):" - "),1)])]))),128))])])])])])])):(0,i.Q3)("",!0)]),(0,i.Lk)("div",J,[r.groupRows.length?((0,i.uX)(),(0,i.CE)("div",q,[t[6]||(t[6]=(0,i.Lk)("div",{class:"modal-titleTABLE"},"Group Notification Details",-1)),(0,i.Lk)("div",j,[(0,i.Lk)("div",Z,[(0,i.Lk)("div",ee,[(0,i.Lk)("table",te,[(0,i.bF)(d,{columns:[{label:"Group Name",key:"name",minWidth:"200px"},{label:"Organization Name",key:"organization_name",minWidth:"200px"},{label:"Org Contact Email",key:"org_contact_email",minWidth:"200px"}]}),(0,i.Lk)("tbody",null,[r.groupRows.length?(0,i.Q3)("",!0):((0,i.uX)(),(0,i.CE)("tr",ae,[...t[5]||(t[5]=[(0,i.Lk)("td",{colspan:"3",style:{"text-align":"center",padding:"20px"}}," No groups targeted. ",-1)])])),((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(r.groupRows,e=>((0,i.uX)(),(0,i.CE)("tr",{key:e.id},[(0,i.Lk)("td",null,(0,n.v_)(e.name),1),(0,i.Lk)("td",null,(0,n.v_)(e.organization_name),1),(0,i.Lk)("td",null,(0,n.v_)(e.org_contact_email),1)]))),128))])])])])])])):(0,i.Q3)("",!0)])])])])):(0,i.Q3)("",!0)}const ne={name:"NotificationDetail",components:{TableHeader:F.A},props:{visible:{type:Boolean,default:!1},announcement:{type:Object,default:null},selectedNotification:{type:Object,default:null},groups:{type:Array,default:()=>[]},organizations:{type:Array,default:()=>[]},notifications:{type:Array,default:()=>[]}},emits:["close"],data(){return{}},computed:{announcementEffective(){return this.announcement||this.selectedNotification||null},announcementBodyShort(){const e=this.announcementEffective&&(this.announcementEffective.body||"");return String(e||"").slice(0,120)},announcementScheduledAt(){return this.announcementEffective&&(this.announcementEffective.scheduled_at||this.announcementEffective.sent_at)||""},announcementStatus(){const e=this.announcementEffective||{},t=!(!e.sent_at&&0!==e.sent_at),a=!(!e.scheduled_at&&0!==e.scheduled_at);return t?"sent":a?"scheduled":"failed"},notificationsMap(){const e=new Map;return this.notifications?(this.notifications.forEach(t=>{t.notifiable_id&&e.set(Number(t.notifiable_id),t)}),e):e},allRecipients(){const e=this.organizationRecipients||[],t=this.adminRecipients||[],a=[...e],i=new Set(e.map(e=>Number(e.id)));return t.forEach(e=>{const t=Number(e.id);i.has(t)||a.push(e)}),a.forEach(e=>{const t=Number(e.id),a=this.notificationsMap.get(t);e.read_at=a?a.read_at:null}),a},organizationRecipients(){const e=new Map,t=this.announcementEffective;return t?((t.organizations||[]).forEach(t=>{const a=t.user_id??t.user?.id??null,i=t.name??t.organization_name??"",n=t.contact_email??t.admin_email??null,o=t.user_first_name??t.user?.first_name??"",s=t.user_last_name??t.user?.last_name??"";a&&!e.has(Number(a))&&e.set(Number(a),{id:Number(a),organization_name:i,name:`${o||""} ${s||""}`.trim(),email:n})}),Array.from(e.values())):[]},adminRecipients(){const e=new Map,t=this.announcementEffective;return t?((t.admins||[]).forEach(t=>{t&&t.id&&!e.has(t.id)&&e.set(t.id,{id:t.id,name:t.name||`${t.first_name||""} ${t.last_name||""}`.trim(),email:t.email})}),Array.from(e.values())):[]},groupRows(){if(Array.isArray(this.groups)&&this.groups.length)return this.groups.map(e=>({id:e.id,name:e.name||`Group ${e.id}`,organization_id:e.organization_id||null,organization_name:e.organization_name||"",org_contact_email:e.org_contact_email||null}));const e=this.announcementEffective||{},t=e.groups||[],a=e.organizations||this.organizations||[],i=new Map;return a.forEach(e=>i.set(Number(e.id),e)),t.map(e=>({id:e.id,name:e.name||`Group ${e.id}`,organization_id:e.organization_id,organization_name:e.organization_name,org_contact_email:e.org_contact_email}))}},methods:{formatDateTime(e){if(!e)return"—";try{const t=new Date(e);if(isNaN(t.getTime()))return e;const a=String(t.getDate()).padStart(2,"0"),i=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],n=i[t.getMonth()],o=t.getFullYear();let s=t.getHours();const l=String(t.getMinutes()).padStart(2,"0"),r=s>=12?"PM":"AM";return s%=12,s=s||12,`${a} ${n},${o} ${s}:${l} ${r}`}catch{return e}}}};var oe=a(6262);const se=(0,oe.A)(ne,[["render",ie],["__scopeId","data-v-9a5ca7b0"]]),le=se;var re=a(2281),de=a(5298),ce=a(4117),ue=a(3413);const he={name:"Notifications",components:{MainLayout:T.A,Pagination:C.A,TableHeader:F.A,NotificationDetail:le,FormDropdown:re.ad,FormRow:re.fh,FormInput:de.A,FormLabel:re.lR,FormDateTime:re.Ui,MultiSelectDropdown:ce.A,Toast:ue.A},data(){return{isAlive:!1,showPageDropdown:!1,showSendModal:!1,showDetailModal:!1,selectedNotification:null,pageSize:10,currentPage:1,sortKey:"",sortAsc:!0,selectedOrganizations:[],selectedAdmin:"",selectedAdmins:[],selectedGroups:[],scheduledDate:"",scheduledTime:"",organizations:[],groups:[],admins:[],notifications:[],announcements:[],detailData:null}},computed:{totalPages(){return Math.ceil(this.notifications.length/this.pageSize)||1},paginatedNotifications(){let e=[...this.notifications];this.sortKey&&e.sort((e,t)=>{const a=e[this.sortKey]||"",i=t[this.sortKey]||"";return a<i?this.sortAsc?-1:1:a>i?this.sortAsc?1:-1:0});const t=(this.currentPage-1)*this.pageSize;return e.slice(t,t+this.pageSize)},paginationPages(){const e=this.totalPages;if(e<=7)return Array.from({length:e},(e,t)=>t+1);{const t=[1];this.currentPage>4&&t.push("...");for(let a=Math.max(2,this.currentPage-1);a<=Math.min(e-1,this.currentPage+1);a++)t.push(a);return this.currentPage<e-3&&t.push("..."),t.push(e),t}}},methods:{async openDetail(e){if(!e||!e.id)return console.error("Invalid item for detail view:",e),void this.$toast.add({severity:"error",summary:"Error",detail:"Cannot load details for invalid item.",life:3e3});try{const t=U["default"].get("authToken"),a=await x.A.get(`http://127.0.0.1:8000/api/announcements/${e.id}`,{headers:{Authorization:`Bearer ${t}`}});a.data&&(this.detailData=a.data,this.selectedNotification=a.data.announcement,this.showDetailModal=!0)}catch(t){console.error("Failed to fetch notification details",t),this.$toast.add({severity:"error",summary:"Error",detail:"Failed to fetch notification details. Please try again.",life:3e3})}},closeDetail(){this.showDetailModal=!1,this.selectedNotification=null,this.detailData=null},goToPage(e){"..."===e||e<1||e>this.totalPages||(this.currentPage=e)},selectPageSize(e){this.pageSize=e,this.currentPage=1,this.showPageDropdown=!1},sortBy(e){this.sortKey===e?this.sortAsc=!this.sortAsc:(this.sortKey=e,this.sortAsc=!0)},formatLocalDateTime(e){if(!e)return"";let t=null;try{if(/T.*Z$/.test(e)||/T.*[+-]\d{2}:?\d{2}$/.test(e))t=new Date(e);else{const a=(e||"").match(/^(\d{4})-(\d{2})-(\d{2})[ T](\d{2}):(\d{2})(?::(\d{2}))?$/);if(a){const e=parseInt(a[1],10),i=parseInt(a[2],10)-1,n=parseInt(a[3],10),o=parseInt(a[4],10),s=parseInt(a[5],10),l=parseInt(a[6],10)||0,r=Date.UTC(e,i,n,o,s,l);t=new Date(r)}else t=new Date(e)}}catch(c){console.warn("Date parse error:",c),t=new Date(e)}if(!t||isNaN(t.getTime()))return e||"";const a=String(t.getDate()).padStart(2,"0"),i=["JAN","FEB","MAR","APR","MAY","JUN","JUL","AUG","SEP","OCT","NOV","DEC"],n=i[t.getMonth()],o=t.getFullYear();let s=t.getHours();const l=String(t.getMinutes()).padStart(2,"0"),r=s>=12?"PM":"AM";s%=12;const d=`${s}:${l} ${r}`;return`${a} ${n},${o} ${d}`},async fetchOrganizations(){try{const e={NODE_ENV:"production",VUE_APP_API_BASE_URL:"http://127.0.0.1:8000",BASE_URL:"/"}.VUE_APP_API_URL||"/api",t=U["default"].get("authToken"),a=await x.A.get(e+"/organizations",{headers:{Authorization:`Bearer ${t}`}});this.isAlive&&(this.organizations=a.data)}catch(e){console.error("Error fetching organizations:",e),this.isAlive&&(this.organizations=[])}},async fetchGroups(){try{const e={NODE_ENV:"production",VUE_APP_API_BASE_URL:"http://127.0.0.1:8000",BASE_URL:"/"}.VUE_APP_API_URL||"/api",t=U["default"].get("authToken"),a=await x.A.get(e+"/groups",{headers:{Authorization:`Bearer ${t}`}});this.isAlive&&(this.groups=a.data)}catch(e){console.error("Error fetching groups:",e),this.isAlive&&(this.groups=[])}},async fetchAdmins(){try{const e={NODE_ENV:"production",VUE_APP_API_BASE_URL:"http://127.0.0.1:8000",BASE_URL:"/"}.VUE_APP_API_URL||"/api",t=U["default"].get("authToken"),a=await x.A.get(e+"/users",{headers:{Authorization:`Bearer ${t}`}});this.isAlive&&(this.admins=a.data)}catch(e){console.error("Error fetching admins:",e),this.isAlive&&(this.admins=[])}},async fetchNotifications(){try{const e={NODE_ENV:"production",VUE_APP_API_BASE_URL:"http://127.0.0.1:8000",BASE_URL:"/"}.VUE_APP_API_URL||"/api",t=U["default"].get("authToken"),a=await x.A.get(e+"/announcements",{headers:{Authorization:`Bearer ${t}`}});this.isAlive&&(Array.isArray(a.data)?this.notifications=a.data:a.data&&Array.isArray(a.data.data)?this.notifications=a.data.data:a.data&&Array.isArray(a.data.notifications)?this.notifications=a.data.notifications:this.notifications=[])}catch(e){console.error("Error fetching notifications:",e),this.isAlive&&(this.notifications=[])}},async sendNotification(){try{const e={NODE_ENV:"production",VUE_APP_API_BASE_URL:"http://127.0.0.1:8000",BASE_URL:"/"}.VUE_APP_API_URL||"/api",t=U["default"].get("authToken");let a;if(this.scheduledDate&&this.scheduledTime){let e=this.scheduledTime;5===e.length&&(e+=":00");const t=new Date(`${this.scheduledDate}T${e}`),i=e=>String(e).padStart(2,"0"),n=t.getUTCFullYear(),o=i(t.getUTCMonth()+1),s=i(t.getUTCDate()),l=i(t.getUTCHours()),r=i(t.getUTCMinutes()),d=i(t.getUTCSeconds());a=`${n}-${o}-${s} ${l}:${r}:${d}`}const i={organization_ids:this.selectedOrganizations.map(e=>e.id),group_ids:this.selectedGroups.map(e=>e.id),admin_ids:this.selectedAdmins.map(e=>e.id),body:this.$el.querySelector(".modal-textarea")?this.$el.querySelector(".modal-textarea").value:""};a&&(i.scheduled_at=a),await x.A.post(e+"/notifications/send",i,{headers:{Authorization:`Bearer ${t}`}}),this.isAlive&&(this.showSendModal=!1,this.resetForm(),this.$toast&&this.$toast.add&&this.$toast.add({severity:"success",summary:"Success",detail:"Announcement sent!",life:3e3}))}catch(e){console.error("Error sending announcement:",e),this.isAlive&&this.$toast&&this.$toast.add&&this.$toast.add({severity:"error",summary:"Error",detail:"Failed to send announcement",life:4e3})}},resetForm(){this.selectedOrganizations=[],this.selectedAdmins=[],this.selectedGroups=[],this.scheduledDate="",this.scheduledTime="";const e=this.$el.querySelector(".modal-textarea");e&&(e.value="")}},mounted(){this.isAlive=!0,this.fetchOrganizations(),this.fetchGroups(),this.fetchAdmins(),this.fetchNotifications()},beforeUnmount(){this.isAlive=!1}},me=(0,oe.A)(he,[["render",$],["__scopeId","data-v-daed55e4"]]),pe=me}}]);
//# sourceMappingURL=323.a8c41976.js.map