"use strict";(self["webpackChunkdolphin"]=self["webpackChunkdolphin"]||[]).push([[761],{8761:(t,e,a)=>{a.r(e),a.d(e,{default:()=>_});var l=a(641),o=a(3751);const i={class:"page"},n={class:"lead-capture-outer"},r={class:"lead-capture-card"},s={class:"org-edit-actions"};function d(t,e,a,d,u,c){const m=(0,l.g2)("FormLabel"),f=(0,l.g2)("FormInput"),p=(0,l.g2)("FormDropdown"),h=(0,l.g2)("FormRow"),g=(0,l.g2)("MainLayout");return(0,l.uX)(),(0,l.Wv)(g,null,{default:(0,l.k6)(()=>[(0,l.Lk)("div",i,[(0,l.Lk)("div",n,[(0,l.Lk)("div",r,[e[42]||(e[42]=(0,l.Lk)("h2",{class:"lead-capture-card-title"},"Edit Organization",-1)),(0,l.Lk)("form",{class:"lead-capture-form",onSubmit:e[21]||(e[21]=(0,o.D$)((...t)=>c.updateDetails&&c.updateDetails(...t),["prevent"]))},[(0,l.bF)(h,null,{default:(0,l.k6)(()=>[(0,l.Lk)("div",null,[(0,l.bF)(m,null,{default:(0,l.k6)(()=>[...e[22]||(e[22]=[(0,l.eW)("Organization Name",-1)])]),_:1}),(0,l.bF)(f,{modelValue:u.form.orgName,"onUpdate:modelValue":e[0]||(e[0]=t=>u.form.orgName=t),icon:"fas fa-cog",placeholder:"Flexi-Finders"},null,8,["modelValue"])]),(0,l.Lk)("div",null,[(0,l.bF)(m,null,{default:(0,l.k6)(()=>[...e[23]||(e[23]=[(0,l.eW)("Organization Size",-1)])]),_:1}),(0,l.bF)(p,{modelValue:u.form.orgSize,"onUpdate:modelValue":e[1]||(e[1]=t=>u.form.orgSize=t),icon:"fas fa-users",options:[{value:"",text:"Select ",disabled:!0},{value:"Large",text:"250+ Employees (Large)"},{value:"Medium",text:"100-249 Employees (Medium)"},{value:"Small",text:"1-99 Employees (Small)"}]},null,8,["modelValue"])]),(0,l.Lk)("div",null,[(0,l.bF)(m,null,{default:(0,l.k6)(()=>[...e[24]||(e[24]=[(0,l.eW)("Source",-1)])]),_:1}),(0,l.bF)(p,{modelValue:u.form.source,"onUpdate:modelValue":e[2]||(e[2]=t=>u.form.source=t),icon:"fas fa-bullhorn",options:[{value:"",text:"Select",disabled:!0},{value:"Google",text:"Google"},{value:"Friend",text:"Friend"},{value:"Colleague",text:"Colleague"},{value:"Other",text:"Other"}]},null,8,["modelValue"])])]),_:1}),(0,l.bF)(h,null,{default:(0,l.k6)(()=>[(0,l.Lk)("div",null,[(0,l.bF)(m,null,{default:(0,l.k6)(()=>[...e[25]||(e[25]=[(0,l.eW)("Country",-1)])]),_:1}),(0,l.bF)(p,{modelValue:u.form.country_id,"onUpdate:modelValue":e[3]||(e[3]=t=>u.form.country_id=t),icon:"fas fa-globe",onChange:c.onCountryChange,options:[{value:null,text:"Select",disabled:!0},...u.countries.map(t=>({value:t.id,text:t.name}))]},null,8,["modelValue","onChange","options"])]),(0,l.Lk)("div",null,[(0,l.bF)(m,null,{default:(0,l.k6)(()=>[...e[26]||(e[26]=[(0,l.eW)("State",-1)])]),_:1}),(0,l.bF)(p,{modelValue:u.form.state_id,"onUpdate:modelValue":e[4]||(e[4]=t=>u.form.state_id=t),icon:"fas fa-map-marker-alt",onChange:c.onStateChange,options:[{value:null,text:"Select",disabled:!0},...u.states.map(t=>({value:t.id,text:t.name}))]},null,8,["modelValue","onChange","options"])]),(0,l.Lk)("div",null,[(0,l.bF)(m,null,{default:(0,l.k6)(()=>[...e[27]||(e[27]=[(0,l.eW)("City",-1)])]),_:1}),(0,l.bF)(p,{modelValue:u.form.city_id,"onUpdate:modelValue":e[5]||(e[5]=t=>u.form.city_id=t),icon:"fas fa-map-marker-alt",options:[{value:null,text:"Select",disabled:!0},...u.cities.map(t=>({value:t.id,text:t.name}))]},null,8,["modelValue","options"])])]),_:1}),(0,l.bF)(h,null,{default:(0,l.k6)(()=>[(0,l.Lk)("div",null,[(0,l.bF)(m,null,{default:(0,l.k6)(()=>[...e[28]||(e[28]=[(0,l.eW)("Address",-1)])]),_:1}),(0,l.bF)(f,{modelValue:u.form.address,"onUpdate:modelValue":e[6]||(e[6]=t=>u.form.address=t),icon:"fas fa-map-marker-alt",placeholder:"Enter address"},null,8,["modelValue"])]),(0,l.Lk)("div",null,[(0,l.bF)(m,null,{default:(0,l.k6)(()=>[...e[29]||(e[29]=[(0,l.eW)("PIN",-1)])]),_:1}),(0,l.bF)(f,{modelValue:u.form.zip,"onUpdate:modelValue":e[7]||(e[7]=t=>u.form.zip=t),icon:"fas fa-map-pin",placeholder:"Enter PIN code"},null,8,["modelValue"])]),(0,l.Lk)("div",null,[(0,l.bF)(m,null,{default:(0,l.k6)(()=>[...e[30]||(e[30]=[(0,l.eW)("Â ",-1)])]),_:1})])]),_:1}),(0,l.bF)(h,null,{default:(0,l.k6)(()=>[(0,l.Lk)("div",null,[(0,l.bF)(m,null,{default:(0,l.k6)(()=>[...e[31]||(e[31]=[(0,l.eW)("Contract Start",-1)])]),_:1}),(0,l.Lk)("div",{class:"disabled-clickable",onClick:e[9]||(e[9]=(...t)=>c.onDisabledClick&&c.onDisabledClick(...t))},[(0,l.bF)(f,{modelValue:u.form.contractStart,"onUpdate:modelValue":e[8]||(e[8]=t=>u.form.contractStart=t),icon:"fas fa-calendar-alt",disabled:""},null,8,["modelValue"])])]),(0,l.Lk)("div",null,[(0,l.bF)(m,null,{default:(0,l.k6)(()=>[...e[32]||(e[32]=[(0,l.eW)("Contract End",-1)])]),_:1}),(0,l.Lk)("div",{class:"disabled-clickable",onClick:e[11]||(e[11]=(...t)=>c.onDisabledClick&&c.onDisabledClick(...t))},[(0,l.bF)(f,{modelValue:u.form.contractEnd,"onUpdate:modelValue":e[10]||(e[10]=t=>u.form.contractEnd=t),icon:"fas fa-calendar-alt",disabled:""},null,8,["modelValue"])])]),(0,l.Lk)("div",null,[(0,l.bF)(m,null,{default:(0,l.k6)(()=>[...e[33]||(e[33]=[(0,l.eW)("Last Contacted",-1)])]),_:1}),(0,l.Lk)("div",{class:"disabled-clickable",onClick:e[13]||(e[13]=(...t)=>c.onDisabledClick&&c.onDisabledClick(...t))},[(0,l.bF)(f,{modelValue:u.form.lastContacted,"onUpdate:modelValue":e[12]||(e[12]=t=>u.form.lastContacted=t),icon:"fas fa-history",disabled:"",placeholder:"Last contacted date"},null,8,["modelValue"])])])]),_:1}),e[41]||(e[41]=(0,l.Lk)("div",{class:"org-edit-divider"},null,-1)),(0,l.bF)(h,null,{default:(0,l.k6)(()=>[(0,l.Lk)("div",null,[(0,l.bF)(m,null,{default:(0,l.k6)(()=>[...e[34]||(e[34]=[(0,l.eW)("First Name",-1)])]),_:1}),(0,l.bF)(f,{modelValue:u.form.firstName,"onUpdate:modelValue":e[14]||(e[14]=t=>u.form.firstName=t),icon:"fas fa-user",placeholder:"Enter first name"},null,8,["modelValue"])]),(0,l.Lk)("div",null,[(0,l.bF)(m,null,{default:(0,l.k6)(()=>[...e[35]||(e[35]=[(0,l.eW)("Last Name",-1)])]),_:1}),(0,l.bF)(f,{modelValue:u.form.lastName,"onUpdate:modelValue":e[15]||(e[15]=t=>u.form.lastName=t),icon:"fas fa-user",placeholder:"Enter last name"},null,8,["modelValue"])]),(0,l.Lk)("div",null,[(0,l.bF)(m,null,{default:(0,l.k6)(()=>[...e[36]||(e[36]=[(0,l.eW)("Admin Email",-1)])]),_:1}),(0,l.bF)(f,{modelValue:u.form.adminEmail,"onUpdate:modelValue":e[16]||(e[16]=t=>u.form.adminEmail=t),icon:"fas fa-envelope",type:"email",placeholder:"Admin email"},null,8,["modelValue"])])]),_:1}),(0,l.bF)(h,null,{default:(0,l.k6)(()=>[(0,l.Lk)("div",null,[(0,l.bF)(m,null,{default:(0,l.k6)(()=>[...e[37]||(e[37]=[(0,l.eW)("Admin Phone",-1)])]),_:1}),(0,l.bF)(f,{modelValue:u.form.adminPhone,"onUpdate:modelValue":e[17]||(e[17]=t=>u.form.adminPhone=t),icon:"fas fa-phone",placeholder:"Admin phone"},null,8,["modelValue"])]),(0,l.Lk)("div",null,[(0,l.bF)(m,null,{default:(0,l.k6)(()=>[...e[38]||(e[38]=[(0,l.eW)("Sales Person",-1)])]),_:1}),(0,l.bF)(f,{modelValue:u.form.salesPerson,"onUpdate:modelValue":e[18]||(e[18]=t=>u.form.salesPerson=t),icon:"fas fa-user-tie",placeholder:"Enter sales person name"},null,8,["modelValue"])]),(0,l.Lk)("div",null,[(0,l.bF)(m,null,{default:(0,l.k6)(()=>[...e[39]||(e[39]=[(0,l.eW)("Certified Staff",-1)])]),_:1}),(0,l.bF)(f,{modelValue:u.form.certifiedStaff,"onUpdate:modelValue":e[19]||(e[19]=t=>u.form.certifiedStaff=t),icon:"fas fa-users",type:"number",placeholder:"Enter number of certified staff"},null,8,["modelValue"])])]),_:1}),(0,l.Lk)("div",s,[(0,l.Lk)("button",{type:"button",class:"org-edit-cancel",onClick:e[20]||(e[20]=(...e)=>t.cancelEdit&&t.cancelEdit(...e))}," Cancel "),e[40]||(e[40]=(0,l.Lk)("button",{type:"submit",class:"org-edit-update"}," Update Details ",-1))])],32)])])])]),_:1})}var u=a(2724),c=a(8608),m=a(4335),f=a(3193);const p={name:"OrganizationEdit",components:{MainLayout:u.A,FormRow:c.fh,FormLabel:c.lR,FormInput:c.ZQ,FormDropdown:c.ad},data(){return{form:{orgName:"",orgSize:"",source:"",address:"",zip:"",country_id:null,state_id:null,city_id:null,contractStart:"",contractEnd:"",firstName:"",lastName:"",adminEmail:"",adminPhone:"",salesPerson:"",lastContacted:"",certifiedStaff:""},orgId:null,countries:[],states:[],cities:[]}},mounted(){this.fetchCountries(),this.fetchOrganization(),this.$nextTick(()=>{const t=this.form.orgName||this.$route.params.orgName||"";this.$root&&this.$root.$emit&&this.$root.$emit("page-title-override",t?`Edit organization : ${t}`:"Edit organization")})},methods:{async fetchOrganization(){try{const t=f["default"].get("authToken"),e=t?{Authorization:`Bearer ${t}`}:{},a=this.$route.params.id;if(!a)return;const l=await m.A.get(`http://127.0.0.1:8000/api/organizations/${a}`,{headers:e}),o=l.data;if(o){const t=o.user||{},e=t.user_details||{},a=t.first_name||o.first_name||"",l=t.last_name||o.last_name||"",i=o.org_size||e.org_size||"";let n="";/large/i.test(i)?n="Large":/medium/i.test(i)?n="Medium":(/small/i.test(i)||/1-99|250\+/.test(i))&&(n="Small");const r=o.source||o.find_us||e.find_us||"",s=o.country_id||e.country_id||null,d=o.state_id||e.state_id||null,u=o.city_id||e.city_id||null;this.orgId=o.id,this.form={orgName:o.org_name||"",orgSize:n||"",source:r||"",address:o.address||e.address||"",zip:o.zip||e.zip||"",country_id:s,state_id:d,city_id:u,contractStart:o.contract_start?this.formatContractDate(o.contract_start):"",contractEnd:o.contract_end?this.formatContractDate(o.contract_end):"",firstName:a||(o.main_contact||"").split(" ")[0]||"",lastName:l||(o.main_contact||"").split(" ").slice(1).join(" ")||"",adminEmail:t.email||o.admin_email||"",adminPhone:e.phone||o.admin_phone||"",salesPerson:o.sales_person||"",lastContacted:o.last_contacted?this.formatLastContacted(o.last_contacted):"",certifiedStaff:o.certified_staff||e.certified_staff||""},this.form.country_id&&await this.fetchStates(),this.form.state_id&&await this.fetchCities()}}catch(t){console.error("Failed to fetch organization details",t)}},formatContractDate(t){try{const e=String(t).match(/^(\d{4})-(\d{2})-(\d{2})(?:[ T](\d{2}):(\d{2})(?::(\d{2}))?)?$/);let a;if(e){const t=parseInt(e[1],10),l=parseInt(e[2],10)-1,o=parseInt(e[3],10),i=e[4]?parseInt(e[4],10):0,n=e[5]?parseInt(e[5],10):0,r=e[6]?parseInt(e[6],10):0;a=new Date(Date.UTC(t,l,o,i,n,r))}else a=new Date(t);const l=String(a.getDate()).padStart(2,"0"),o=a.toLocaleString("en-GB",{month:"short"}).toUpperCase(),i=a.getFullYear();return`${l} ${o},${i}`}catch(e){return t}},formatLastContacted(t){try{const e=String(t).match(/^(\d{4})-(\d{2})-(\d{2})(?:[ T](\d{2}):(\d{2})(?::(\d{2}))?)?$/);let a;if(e){const t=parseInt(e[1],10),l=parseInt(e[2],10)-1,o=parseInt(e[3],10),i=e[4]?parseInt(e[4],10):0,n=e[5]?parseInt(e[5],10):0,r=e[6]?parseInt(e[6],10):0;a=new Date(Date.UTC(t,l,o,i,n,r))}else a=new Date(t);const l=String(a.getDate()).padStart(2,"0"),o=a.toLocaleString("en-GB",{month:"short"}).toUpperCase(),i=a.getFullYear();let n=a.getHours();const r=String(a.getMinutes()).padStart(2,"0"),s=n>=12?"PM":"AM";return n%=12,n=n||12,`${l} ${o},${i} ${n}:${r} ${s}`}catch(e){return t}},parseContractInput(t){if(!t)return null;try{const e=String(t).replace(/,/g,"").replace(/\s+/g," "),a=e.split(" ");let l=null;if(a.length>=3){const t=`${a[0]} ${a[1]} ${a[2]}`;l=new Date(t)}if(l&&!isNaN(l.getTime())||(l=new Date(t)),isNaN(l.getTime()))return null;const o=l.getUTCFullYear(),i=String(l.getUTCMonth()+1).padStart(2,"0"),n=String(l.getUTCDate()).padStart(2,"0"),r=String(l.getUTCHours()).padStart(2,"0"),s=String(l.getUTCMinutes()).padStart(2,"0"),d=String(l.getUTCSeconds()).padStart(2,"0");return`${o}-${i}-${n} ${r}:${s}:${d}`}catch(e){return null}},parseLastContactedInput(t){if(!t)return null;try{const e=String(t).replace(/,/g," "),a=new Date(e);if(isNaN(a.getTime()))return null;const l=a.getUTCFullYear(),o=String(a.getUTCMonth()+1).padStart(2,"0"),i=String(a.getUTCDate()).padStart(2,"0"),n=String(a.getUTCHours()).padStart(2,"0"),r=String(a.getUTCMinutes()).padStart(2,"0"),s=String(a.getUTCSeconds()).padStart(2,"0");return`${l}-${o}-${i} ${n}:${r}:${s}`}catch(e){return null}},onDisabledClick(){const t="This field is not editable.";this.$toast&&"function"===typeof this.$toast.add?this.$toast.add({severity:"info",summary:"Not editable",detail:t,life:3e3}):alert(t)},async updateDetails(){try{const t=f["default"].get("authToken"),e=t?{Authorization:`Bearer ${t}`}:{},a=this.orgId;if(!a)return void(this.$toast&&"function"===typeof this.$toast.add&&this.$toast.add({severity:"error",summary:"Update Failed",detail:"Organization not found.",life:3500}));let l=this.form.orgSize;"Small"===this.form.orgSize?l="1-99 Employees (Small)":"Medium"===this.form.orgSize?l="100-249 Employees (Medium)":"Large"===this.form.orgSize&&(l="250+ Employees (Large)");const o=this.parseContractInput(this.form.contractStart),i=this.parseContractInput(this.form.contractEnd),n=this.parseLastContactedInput(this.form.lastContacted),r={org_name:this.form.orgName,org_size:l,source:this.form.source||null,address:this.form.address||null,city_id:this.form.city_id||null,state_id:this.form.state_id||null,zip:this.form.zip||null,country_id:this.form.country_id||null,sales_person:this.form.salesPerson||null,certified_staff:this.form.certifiedStaff||null,first_name:this.form.firstName||null,last_name:this.form.lastName||null,admin_email:this.form.adminEmail||null,admin_phone:this.form.adminPhone||null,main_contact:`${this.form.firstName} ${this.form.lastName}`.trim(),contract_start:o,contract_end:i,last_contacted:n};await m.A.put(`http://127.0.0.1:8000/api/organizations/${a}`,r,{headers:e}),this.$toast&&"function"===typeof this.$toast.add&&this.$toast.add({severity:"success",summary:"Updated",detail:"Organization updated successfully.",life:3500});const s=this.orgId||this.$route.params.id;this.$root&&this.$root.$emit&&this.$root.$emit("page-title-override",null),this.$router.push(`/organizations/${s}`)}catch(t){console.error("Failed to update organization",t),this.$toast&&"function"===typeof this.$toast.add&&this.$toast.add({severity:"error",summary:"Update Failed",detail:"Failed to update organization.",life:4500})}},async fetchCountries(){const t="http://127.0.0.1:8000",e=await m.A.get(`${t}/api/countries`);this.countries=e.data},async fetchStates(){if(!this.form.country_id)return void(this.states=[]);const t="http://127.0.0.1:8000",e=await m.A.get(`${t}/api/states?country_id=${this.form.country_id}`);this.states=e.data},async fetchCities(){if(!this.form.state_id)return void(this.cities=[]);const t="http://127.0.0.1:8000",e=await m.A.get(`${t}/api/cities?state_id=${this.form.state_id}`);this.cities=e.data},onCountryChange(){this.form.state_id=null,this.form.city_id=null,this.states=[],this.cities=[],this.fetchStates()},onStateChange(){this.form.city_id=null,this.cities=[],this.fetchCities()}}};var h=a(6262);const g=(0,h.A)(p,[["render",d],["__scopeId","data-v-62d3c71c"]]),_=g}}]);
//# sourceMappingURL=761.46f887d6.js.map